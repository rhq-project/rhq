<?xml version="1.0" encoding="UTF-8"?>

<dbsetup name="content-schema.xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="urn:xmlns:rhq-dbsetup-schema">

    <table name="RHQ_ARCHITECTURE">
        <column name="ID" default="sequence-only" initial="100" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="50" type="VARCHAR2" required="true"/>
        <index name="RHQ_ARCHITECTURE_NAME_IDX" unique="true">
            <field ref="NAME"/>
        </index>
    </table>

    <table name="RHQ_REPO_GROUP_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
    </table>


    <table name="RHQ_REPO_GROUP">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>

        <column name="REPO_GROUP_TYPE_ID" type="INTEGER" references="RHQ_REPO_GROUP_TYPE" required="true"/>

        <index name="RHQ_REPO_GROUP_IDX" unique="true">
            <field ref="NAME"/>
            <field ref="REPO_GROUP_TYPE_ID"/>
        </index>
    </table>


    <table name="RHQ_CONTENT_SOURCE_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DISPLAY_NAME" size="200" type="VARCHAR2" required="false"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="PLUGIN_NAME" size="100" type="VARCHAR2" required="false"/>
        <!-- we might want this as part of natural key -->
        <column name="DEFAULT_LAZY_LOAD" type="BOOLEAN" required="true"/>
        <column name="DEFAULT_DOWNLOAD_MODE" size="16" type="VARCHAR2" required="true"/>
        <column name="DEFAULT_SYNC_SCHEDULE" size="64" type="VARCHAR2" required="false"/>
        <column name="API_CLASS" size="100" type="VARCHAR2" required="true"/>

        <column name="SOURCE_CONFIG_DEF_ID" type="INTEGER" references="RHQ_CONFIG_DEF" required="false"/>

        <index name="RHQ_CONTENT_SOURCE_TYPE_IDX" unique="true">
            <field ref="NAME"/>
            <!-- <field ref="PLUGIN_NAME"/> -->
        </index>
    </table>

    <table name="RHQ_CONTENT_SOURCE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="LAZY_LOAD" type="BOOLEAN" required="true"/>
        <column name="DOWNLOAD_MODE" size="16" type="VARCHAR2" required="true"/>
        <column name="SYNC_SCHEDULE" size="64" type="VARCHAR2" required="false"/>
        <column name="LOAD_ERROR_MESSAGE" type="LONGVARCHAR" required="false"/>
        <column name="CREATION_TIME" type="LONG" required="true"/>
        <column name="LAST_MODIFIED_TIME" type="LONG" required="true"/>

        <column name="CONTENT_SOURCE_TYPE_ID" type="INTEGER" references="RHQ_CONTENT_SOURCE_TYPE" required="true"/>
        <column name="CONFIGURATION_ID" type="INTEGER" references="RHQ_CONFIG" required="false"/>

        <index name="RHQ_CONTENT_SOURCE_IDX" unique="true">
            <field ref="NAME"/>
            <field ref="CONTENT_SOURCE_TYPE_ID"/>
        </index>
    </table>

    <table name="RHQ_REPO">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="CREATION_TIME" type="LONG" required="true"/>
        <column name="LAST_MODIFIED_TIME" type="LONG" required="true"/>
        <column name="IS_CANDIDATE" type="BOOLEAN" required="true"/>
        <column name="SYNC_SCHEDULE" size="64" type="VARCHAR2" required="false"/>
        <column name="OWNER_ID" type="INTEGER" required="false" references="RHQ_SUBJECT" />
        <column name="IS_PRIVATE" type="BOOLEAN" required="true" />
        
        <index name="RHQ_REPO_IDX" unique="true">
            <field ref="NAME"/>
        </index>
    </table>


    <table name="RHQ_REPO_RELATION_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
    </table>


    <table name="RHQ_REPO_RELATION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="RELATED_REPO_ID" type="INTEGER" references="RHQ_REPO" required="true"/>
        <column name="REPO_RELATION_TYPE_ID" type="INTEGER" references="RHQ_REPO_RELATION_TYPE" required="true"/>
    </table>



    <table name="RHQ_PACKAGE_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DISPLAY_NAME" size="200" type="VARCHAR2" required="false"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="CATEGORY" size="50" type="VARCHAR2" required="false"/>
        <column name="DISCOVERY_INTERVAL" type="INTEGER" required="false"/>
        <column name="IS_CREATION_DATA" type="BOOLEAN" required="true"/>
        <column name="SUPPORTS_ARCHITECTURE" type="BOOLEAN" required="true"/>

        <column name="RESOURCE_TYPE_ID" type="INTEGER" references="RHQ_RESOURCE_TYPE" required="false"/>
        <column name="DEPLOYMENT_CONFIG_DEF_ID" type="INTEGER" references="RHQ_CONFIG_DEF" required="false"/>
        <column name="PACKAGE_EXTRA_CONFIG_ID" type="INTEGER" references="RHQ_CONFIG_DEF" required="false"/>

        <index name="RHQ_PACKAGE_TYPE_IDX" unique="true">
            <field ref="NAME"/>
            <field ref="RESOURCE_TYPE_ID"/>
        </index>

    </table>

    <table name="RHQ_PACKAGE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="CLASSIFICATION" size="200" type="VARCHAR2" required="false"/>

        <column name="PACKAGE_TYPE_ID" type="INTEGER" references="RHQ_PACKAGE_TYPE" required="true"/>

        <index name="RHQ_PACKAGE_IDX" unique="true">
            <field ref="NAME"/>
            <field ref="PACKAGE_TYPE_ID"/>
        </index>
    </table>

    <table name="RHQ_PACKAGE_BITS">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="BITS" type="LARGEOBJECT" required="false"/>
    </table>

    <table name="RHQ_PACKAGE_VERSION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="DISPLAY_NAME" size="200" type="VARCHAR2" required="false"/>
        <column name="SHORT_DESCRIPTION" size="10000" type="CLOB" required="false"/>
        <column name="LONG_DESCRIPTION" size="50000" type="CLOB" required="false"/>
        <column name="VERSION" size="500" type="VARCHAR2" required="true"/>
        <column name="DISPLAY_VERSION" size="500" type="VARCHAR2" required="false"/>
        <column name="FILE_NAME" size="255" type="VARCHAR2" required="false"/>
        <column name="FILE_SIZE" type="LONG" required="false"/>
        <column name="FILE_MD5" size="32" type="VARCHAR2" required="false"/>
        <column name="FILE_SHA256" size="64" type="VARCHAR2" required="false"/>
        <column name="FILE_CREATION_TIME" type="LONG" required="false"/>
        <column name="LICENSE_NAME" size="255" type="VARCHAR2" required="false"/>
        <column name="LICENSE_VERSION" size="20" type="VARCHAR2" required="false"/>
        <column name="METADATA" type="BLOB" required="false"/>

        <column name="PACKAGE_ID" type="INTEGER" references="RHQ_PACKAGE" required="true"/>
        <column name="ARCHITECTURE_ID" type="INTEGER" references="RHQ_ARCHITECTURE" required="true"/>
        <column name="CONFIG_ID" type="INTEGER" references="RHQ_CONFIG" required="false"/>
        <column name="PACKAGE_BITS_ID" type="INTEGER" references="RHQ_PACKAGE_BITS" required="false"/>

        <index name="RHQ_PACKAGE_VERSION_IDX" unique="true">
            <field ref="PACKAGE_ID"/>
            <field ref="VERSION"/>
            <field ref="ARCHITECTURE_ID"/>
        </index>

    </table>

    <table name="RHQ_CONTENT_REQ">
        <column name="ID" type="INTEGER" required="true" default="sequence-only" initial="10001" primarykey="true"/>
        <column name="RESOURCE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE"/>
        <column name="STATUS" type="VARCHAR2" required="true" size="16"/>
        <column name="ERROR_MESSAGE" type="LONGVARCHAR" required="false"/>
        <column name="SUBJECT_NAME" type="VARCHAR2" required="true" size="100"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="MTIME" type="LONG" required="true"/>
        <column name="REQUEST_TYPE" type="VARCHAR2" required="true" size="20"/>
        <column name="NOTES" type="VARCHAR2" required="false" size="512"/>
    </table>

    <table name="RHQ_INSTALLED_PACKAGE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="INSTALLATION_TIME" type="LONG" required="false"/>

        <column name="RESOURCE_ID" type="INTEGER" references="RHQ_RESOURCE" required="true"/>
        <column name="PACKAGE_VERSION_ID" type="INTEGER" references="RHQ_PACKAGE_VERSION" required="true"/>
        <column name="SUBJECT_ID" type="INTEGER" references="RHQ_SUBJECT" required="false"/>
    </table>

    <table name="RHQ_INSTALLED_PKG_HIST">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="STATUS" type="VARCHAR2" size="24" required="true"/>
        <column name="ERROR_MESSAGE" type="LONGVARCHAR" required="false"/>
        <column name="HISTORY_TIMESTAMP" type="LONG" required="false"/>

        <column name="PACKAGE_VERSION_ID" type="INTEGER" references="RHQ_PACKAGE_VERSION" required="true"/>
        <column name="RESOURCE_ID" type="INTEGER" references="RHQ_RESOURCE" required="true"/>
        <column name="DEPLOYMENT_CONFIG_ID" type="INTEGER" references="RHQ_CONFIG" required="false"/>
        <column name="CONTENT_SERVICE_REQUEST_ID" type="INTEGER" references="RHQ_CONTENT_REQ" required="false"/>
    </table>

    <table name="RHQ_CONTENT_SRC_SYNC">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="STATUS" type="VARCHAR2" size="16" required="true"/>
        <column name="START_TIME" type="LONG" required="true"/>
        <column name="END_TIME" type="LONG" required="false"/>
        <column name="RESULTS" type="LONGVARCHAR" required="false"/>
        <column name="CONTENT_SRC_ID" type="INTEGER" required="true" references="RHQ_CONTENT_SOURCE"/>
    </table>

   <table name="RHQ_REPO_SYNC">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="STATUS" type="VARCHAR2" size="16" required="true"/>
        <column name="START_TIME" type="LONG" required="true"/>
        <column name="END_TIME" type="LONG" required="false"/>
        <column name="RESULTS" type="LONGVARCHAR" required="false"/>
        <column name="PERCENT_COMPLETE" type="LONG" required="false"/>
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
    </table>


    <table name="RHQ_PACKAGE_INST_STEP">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="STEP_KEY" type="VARCHAR2" size="500" required="true"/>
        <column name="STEP_ORDER" type="INTEGER" required="true"/>
        <column name="DESCRIPTION" type="VARCHAR2" size="4000" required="true"/>
        <column name="ERROR_MSG" type="LONGVARCHAR" required="false"/>
        <column name="RESULT" type="VARCHAR2" size="25" required="true"/>

        <column name="INSTALLED_PKG_HIST_ID" type="INTEGER" references="RHQ_INSTALLED_PKG_HIST"/>
    </table>

    <table name="RHQ_REPO_RESOURCE_MAP">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="RESOURCE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE"/>
        <column name="CTIME" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_RESOURCE_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="RESOURCE_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_REPO_CONTENT_SRC_MAP">                                                               1
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="CONTENT_SRC_ID" type="INTEGER" required="true" references="RHQ_CONTENT_SOURCE"/>
        <column name="CTIME" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_CONTENT_SRC_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="CONTENT_SRC_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_REPO_REPO_GROUP_MAP">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="REPO_GROUP_ID" type="INTEGER" required="true" references="RHQ_REPO_GROUP"/>
        <column name="CTIME" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_REPO_GROUP_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="REPO_GROUP_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_REPO_REPO_RELATION_MAP">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="REPO_RELATION_ID" type="INTEGER" required="true" references="RHQ_REPO_RELATION"/>
        <column name="CTIME" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_REPO_RELATION_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="REPO_RELATION_ID"/>
            </primaryKey>
        </constraint>
    </table>


    <table name="RHQ_REPO_PKG_VERSION_MAP">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="PACKAGE_VERSION_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_VERSION"/>
        <column name="CTIME" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_PKG_VER_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="PACKAGE_VERSION_ID"/>
            </primaryKey>
        </constraint>
        <index name="RHQ_REPO_PKG_VER_MAP_IDX" unique="false">
            <field ref="PACKAGE_VERSION_ID"/>
        </index>
    </table>

    <table name="RHQ_PKG_VER_CONTENT_SRC_MAP">
        <column name="PACKAGE_VERSION_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_VERSION"/>
        <column name="CONTENT_SRC_ID" type="INTEGER" required="true" references="RHQ_CONTENT_SOURCE"/>
        <column name="LOCATION" type="VARCHAR2" size="4000" required="true"/>

        <constraint name="RHQ_PKG_VER_CONTENT_SRC_KEY">
            <primaryKey>
                <field ref="PACKAGE_VERSION_ID"/>
                <field ref="CONTENT_SRC_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_PKG_PRD_MAP">
        <column name="PKG_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_VERSION"/>
        <column name="PRD_ID" type="INTEGER" required="true" references="RHQ_PRD_VER"/>

        <constraint name="RHQ_PKG_PRD_KEY">
            <primaryKey>
                <field ref="PKG_ID"/>
                <field ref="PRD_ID"/>
            </primaryKey>
        </constraint>

    </table>

    <table name="RHQ_DISTRIBUTION_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>

    </table>

    <table name="RHQ_DISTRIBUTION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="DISTRIBUTION_TYPE_ID" type="INTEGER"  required="true" references="RHQ_DISTRIBUTION_TYPE"/>
        <column name="LABEL" size="64" type="VARCHAR2" required="true"/>
        <column name="BASE_PATH" size="256" type="VARCHAR2" required="true"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <index name="RHQ_DISTRIBUTION_IDX" unique="true">
            <field ref="LABEL"/>
            <field ref="BASE_PATH"/>
        </index>

    </table>

    <table name="RHQ_REPO_DISTRIBUTION">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="DISTRIBUTION_ID" type="INTEGER" required="true" references="RHQ_DISTRIBUTION"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_DIST_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="DISTRIBUTION_ID"/>
            </primaryKey>
        </constraint>
    </table>



    <table name="RHQ_DISTRIBUTION_FILE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="DISTRIBUTION_ID" type="INTEGER" required="true" references="RHQ_DISTRIBUTION"/>
        <column name="RELATIVE_FILENAME" size="256" type="VARCHAR2" required="true"/>
        <!--<column name="FILE_SIZE" type="NUMBER" required="true"/>-->
        <column name="MD5SUM" size="64" type="VARCHAR2" required="true"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>
        <!--<column name="CTIME" type="LONG" required="true"/>-->

        <index name="RHQ_DISTRIBUTION_FILE_IDX" unique="true">
            <field ref="DISTRIBUTION_ID"/>
            <field ref="RELATIVE_FILENAME"/>
        </index>
    </table>




    <table name="RHQ_ADVISORY">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="ADVISORY" size="64" type="VARCHAR2" required="true"/>
        <column name="ADVISORY_TYPE" size="64" type="VARCHAR2"  required="true" />
        <column name="ADVISORY_REL" size="64" type="VARCHAR2" required="false"/>
        <column name="ADVISORY_NAME" size="64" type="VARCHAR2" required="false"/>
        <column name="DESCRIPTION" size="4000" type="VARCHAR2" required="false"/>
        <column name="SYNOPSIS" size="4000" type="VARCHAR2" required="true"/>
        <column name="TOPIC" size="4000" type="VARCHAR2" required="false"/>
        <column name="SOLUTION" size="4000" type="VARCHAR2" required="false"/>
        <column name="SEVERITY" size="64" type="VARCHAR2"  required="false"/>
        <column name="ISSUE_DATE" type="LONG" required="false"/>
        <column name="UPDATE_DATE" type="LONG" required="false"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <index name="RHQ_ADVISORY_NAME_UQ" unique="true">
            <field ref="ADVISORY_NAME"/>
        </index>

        <index name="RHQ_ADVISORY_UQ" unique="true">
            <field ref="ADVISORY"/>
        </index>

        <index name="RHQ_ADVISORY_UDATE_IDX" unique="false">
            <field ref="UPDATE_DATE"/>
        </index>
    </table>

    <table name="RHQ_ADVISORY_PACKAGE">
    	  <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="ADVISORY_ID" type="INTEGER" required="true" references="RHQ_ADVISORY"/>
        <column name="PACKAGE_VERSION_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_VERSION"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <index name="RHQ_ADVISORY_PKG_IDX" unique="true">
                <field ref="ADVISORY_ID"/>
                <field ref="PACKAGE_VERSION_ID"/>
        </index>
    </table>

    <table name="RHQ_CVE">
        <column name="ID" default="sequence-only" initial="101" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="64" type="VARCHAR2" required="true"/>
    </table>

    <table name="RHQ_ADVISORY_CVE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="ADVISORY_ID" type="INTEGER" required="true" references="RHQ_ADVISORY"/>
        <column name="CVE_ID" type="INTEGER" required="true" references="RHQ_CVE"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <index name="RHQ_ADVISORY_CVE_IDX" unique="true">
                <field ref="ADVISORY_ID"/>
                <field ref="CVE_ID"/>
        </index>

    </table>

    <table name="RHQ_ADVISORY_BUGLIST">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="ADVISORY_ID" type="INTEGER" required="true" references="RHQ_ADVISORY"/>
        <column name="BUG_ID" size="256" type="VARCHAR2" required="true"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <index name="RHQ_ADVISORY_BUG_IDX" unique="true">
                <field ref="ADVISORY_ID"/>
                <field ref="BUG_ID"/>
        </index>
    </table>


    <table name="RHQ_REPO_ADVISORY">
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>
        <column name="ADVISORY_ID" type="INTEGER" required="true" references="RHQ_ADVISORY"/>
        <column name="LAST_MODIFIED" type="LONG" required="true"/>

        <constraint name="RHQ_REPO_ADV_MAP_KEY">
            <primaryKey>
                <field ref="REPO_ID"/>
                <field ref="ADVISORY_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <!-- BUNDLE_TYPE is things like "Cobbler profile" or "file-based bundle" or "puppet recipe" -->
    <table name="RHQ_BUNDLE_TYPE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="RESOURCE_TYPE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE_TYPE"/>

        <!--  This index is for constraint, not performance -->
        <index name="RHQ_BUNDLE_TYPE_UNIQUE" unique="true">
            <field ref="NAME"/>
        </index>
    </table>

    <!-- BUNDLE is a named piece of content that can be versioned and installed somewhere -->
    <table name="RHQ_BUNDLE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="BUNDLE_TYPE_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_TYPE"/>
        <column name="PACKAGE_TYPE_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_TYPE"/>
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>        

        <!--  This index is for constraint, not performance -->
        <index name="RHQ_BUNDLE_UNIQUE" unique="true">
            <field ref="BUNDLE_TYPE_ID"/>
            <field ref="NAME"/>
        </index>
    </table>

    <!-- BUNDLE_VERSION represents an actual piece of content that needs to be installed somewhere -->
    <table name="RHQ_BUNDLE_VERSION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="VERSION" size="500" type="VARCHAR2" required="true"/>
        <column name="VERSION_ORDER" type="INTEGER" required="true"/>
        <column name="ACTION" type="CLOB" required="true"/>
        <column name="CONFIG_DEF_ID" type="INTEGER" required="false" references="RHQ_CONFIG_DEF" />
        <column name="BUNDLE_ID" type="INTEGER" required="true" references="RHQ_BUNDLE"/>

        <!--  This index is for constraint, not performance -->
        <index name="RHQ_BUNDLE_VERSION_UNIQUE" unique="true">
            <field ref="BUNDLE_ID"/>
            <field ref="NAME"/>
            <field ref="VERSION"/>
        </index>
    </table>

    <!-- Many-to-many table that links many repos to a particular bundle version. destination platforms -->
    <!-- would be required to have associations to the specified repos (to access required content -->
    <table name="RHQ_BUNDLE_VERSION_REPO">
        <column name="BUNDLE_VERSION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_VERSION"/>
        <column name="REPO_ID" type="INTEGER" required="true" references="RHQ_REPO"/>

        <constraint name="RHQ_BUNDLE_VERSION_REPO_KEY">
            <primaryKey>
                <field ref="BUNDLE_VERSION_ID"/>
                <field ref="REPO_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <!-- BUNDLE_FILE represents a file that is associated with (possibly bundled inside) a bundle version -->
    <table name="RHQ_BUNDLE_FILE">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="BUNDLE_VERSION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_VERSION"/>
        <column name="PACKAGE_VERSION_ID" type="INTEGER" required="true" references="RHQ_PACKAGE_VERSION"/>
    </table>

    <!-- A logical destination for a bundle deployment. Defines the platforms and directory on those targets.  -->    
    <table name="RHQ_BUNDLE_DESTINATION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="MTIME" type="LONG" required="true"/>
        <column name="BUNDLE_ID" type="INTEGER" required="true" references="RHQ_BUNDLE"/>        
        <column name="GROUP_ID" type="INTEGER" required="true" references="RHQ_RESOURCE_GROUP"/>        
        <column name="DEPLOY_DIR" size="256" type="VARCHAR2"/>
        <column name="DEST_BASE_DIR_NAME" size="200" type="VARCHAR2" required="true"/>

        <!--  This index is for constraint, not performance -->
        <index name="RHQ_BUNDLE_DESTINATION_UNIQUE" unique="true">
            <field ref="BUNDLE_ID"/>            
            <field ref="GROUP_ID"/>            
            <field ref="DEPLOY_DIR"/>
        </index>
    </table>

    <!-- An actual deployment of a bundle version to a destination, with a specific config. Bundle deployments
         can differ only on ctime, which is assumed to be different -->    
    <table name="RHQ_BUNDLE_DEPLOYMENT">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" size="200" type="VARCHAR2" required="true"/>
        <column name="DESCRIPTION" size="500" type="VARCHAR2" required="false"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="MTIME" type="LONG" required="true"/>
        <column name="BUNDLE_VERSION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_VERSION"/>
        <column name="BUNDLE_DESTINATION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_DESTINATION"/>        
        <column name="CONFIG_ID" type="INTEGER" required="false" references="RHQ_CONFIG" />        
        <column name="SUBJECT_NAME" type="VARCHAR2" required="false" size="255"/>
        <column name="STATUS" type="VARCHAR2" required="true" size="16"/>
        <column name="ERROR_MESSAGE" type="LONGVARCHAR" required="false"/>        
        <column name="IS_LIVE" type="BOOLEAN" required="true"/>        
        <column name="REPLACED_BUNDLE_DEPLOYMENT_ID" type="INTEGER" required="false" references="RHQ_BUNDLE_DEPLOYMENT"/>        
    </table>

    <!-- Represents a bundle version that is deployed on a platform resource -->
    <table name="RHQ_BUNDLE_RES_DEPLOY">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>    
        <column name="BUNDLE_DEPLOYMENT_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_DEPLOYMENT" />
        <column name="RESOURCE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE" />
        <column name="STATUS" type="VARCHAR2" required="true" size="16"/>        
        <column name="CTIME" type="LONG" required="true"/>
        
        <index name="RHQ_BUNDLE_RES_DEPLOY_IDX" unique="true">
            <field ref="BUNDLE_DEPLOYMENT_ID"/>
            <field ref="RESOURCE_ID"/>
        </index>
    </table>

    <table name="RHQ_BUNDLE_RES_DEP_HIST">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="BUNDLE_RES_DEPLOY_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_RES_DEPLOY" />        
        <column name="SUBJECT_NAME" required="false" size="255" type="VARCHAR2"/>
        <column name="AUDIT_TIME" required="true" type="LONG"/>
        <column name="ACTION" required="true" size="128" type="VARCHAR2"/>
        <column name="INFO" required="true" size="512" type="VARCHAR2"/>        
        <column name="CATEGORY" required="false" size="32" type="VARCHAR2"/>        
        <column name="STATUS" required="true" type="VARCHAR2" size="16"/>        
        <column name="MESSAGE" required="false" type="LONGVARCHAR"/>
        <column name="ATTACHMENT" required="false" type="LONGVARCHAR"/>        
    </table>

    <table name="RHQ_TAGGING_BUNDLE_MAP">
        <column name="BUNDLE_ID" type="INTEGER" required="true" references="RHQ_BUNDLE"/>
        <column name="TAG_ID" type="INTEGER" required="true" references="RHQ_TAGGING"/>
        <constraint name="RHQ_TAGGING_BUNDLE_MAP_KEY">
            <primaryKey>
                <field ref="BUNDLE_ID"/>
                <field ref="TAG_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_TAGGING_BUNDLE_VERSION_MAP">
        <column name="BUNDLE_VERSION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_VERSION"/>
        <column name="TAG_ID" type="INTEGER" required="true" references="RHQ_TAGGING"/>
        <constraint name="RHQ_TAGGING_BUNDLE_VER_MAP_KEY">
            <primaryKey>
                <field ref="BUNDLE_VERSION_ID"/>
                <field ref="TAG_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <table name="RHQ_TAGGING_BUNDLE_DEPLOY_MAP">
        <column name="BUNDLE_DEPLOYMENT_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_DEPLOYMENT"/>
        <column name="TAG_ID" type="INTEGER" required="true" references="RHQ_TAGGING"/>
        <constraint name="RHQ_TAGGING_BUNDLE_DEP_MAP_KEY">
            <primaryKey>
                <field ref="BUNDLE_DEPLOYMENT_ID"/>
                <field ref="TAG_ID"/>
            </primaryKey>
        </constraint>
    </table>
    
    <table name="RHQ_TAGGING_BUNDLE_DEST_MAP">
        <column name="BUNDLE_DESTINATION_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_DESTINATION"/>
        <column name="TAG_ID" type="INTEGER" required="true" references="RHQ_TAGGING"/>
        <constraint name="RHQ_TAGGING_BUNDLE_DES_MAP_KEY">
            <primaryKey>
                <field ref="BUNDLE_DESTINATION_ID"/>
                <field ref="TAG_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <!--  Drift Management Tables -->
    <table name="RHQ_DRIFT_DEF_TEMPLATE">
        <column name="ID" default="sequence-only" initial="1001" primarykey="true" required="true" type="INTEGER"/>
        <column name="RESOURCE_TYPE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE_TYPE"/>
        <column name="CONFIG_ID" type="INTEGER" required="true" references="RHQ_CONFIG"/>
        <column name="NAME" type="VARCHAR2" size="128" required="true"/>
        <column name="DESCRIPTION" type="VARCHAR2" size="512" required="false"/>
        <!-- true if defined by user, false if provided by plugin -->
        <column name="IS_USER_DEFINED" type="BOOLEAN" required="true"/>        
        <!--
          Change sets are managed by the drift server plugins; therefore, we cannot maintain
          a FK constraint on the change set id. And the type cannot be integer because
          other back ends like MongoDB use other types that are basically variants of a
          UUID

          jsanda
        -->
        <column name="DRIFT_CHANGE_SET_ID" type="VARCHAR2" size="64" required="false"/>
        <column name="CTIME" type="LONG" required="true"/>

        <index name="RHQ_DRIFT_DEF_TEMPLATE_UNIQUE" unique="true">
            <field ref="RESOURCE_TYPE_ID"/>
            <field ref="NAME"/>
        </index>
    </table>

    <!--  Content of a file being managed for drift. Used for diff and/or remediation -->
    <table name="RHQ_DRIFT_FILE">
        <column name="HASH_ID" type="VARCHAR2" size="64" primarykey="true" required="true"/>        
        <column name="CTIME" type="LONG" required="true"/>
        <column name="DATA" type="LARGEOBJECT" required="false"/>
        <column name="DATA_SIZE" type="LONG" required="false"/>
        <column name="STATUS" type="VARCHAR2" size="20" required="true"/>
    </table>
    
    <!--  A single drift definition defining file tracking
          Note: A resource or group (todo: group, other?) can have zero or more drift configurations.    
          Note: The name, interval and is_enabled values are also stored withing the referenced config.
                This allows us to use the config editor to manipulate all fields.
          Note: Name is read-only
          Note: Interval unit is millis 
    -->
    <table name="RHQ_DRIFT_DEFINITION">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="CONFIG_ID" type="INTEGER" required="true" references="RHQ_CONFIG"/>
        <column name="RESOURCE_ID" type="INTEGER" required="false" references="RHQ_RESOURCE"/>
        <column name="DRIFT_DEF_TEMPLATE_ID" type="INTEGER" required="false" references="RHQ_DRIFT_DEF_TEMPLATE"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="NAME" type="VARCHAR2" size="512" required="true"/>
        <column name="DESCRIPTION" type="VARCHAR2" size="512" required="false"/>
        <column name="INTERVAL" type="LONG" required="true"/>
        <column name="IS_ENABLED" type="BOOLEAN" required="true"/>        
        <column name="DRIFT_HANDLING_MODE" type="VARCHAR2" size="20" required="true"/>
        <column name="IS_PINNED" type="BOOLEAN" required="true"/>
        <column name="IS_ATTACHED" type="BOOLEAN" required="true"/>
        <column name="COMPLIANCE_STATUS" type="INTEGER" required="true"/>
    </table>

    <!--  A set of drift records (note, this is for the JPA server plugin impl only) -->
    <table name="RHQ_DRIFT_SET">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
    </table>

    <!--  A drift change-set report for a resource (note, this is for the JPA server plugin impl only) -->
    <table name="RHQ_DRIFT_CHANGE_SET">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="DRIFT_SET_ID" type="INTEGER" required="false" references="RHQ_DRIFT_SET"/>
        <column name="CTIME" type="LONG" required="true"/>
        <!-- Version 0 is initial change-set -->
        <column name="VERSION" type="INTEGER" required="true"/>
        <column name="CATEGORY" type="VARCHAR2" size="20" required="true"/>                         
        <column name="RESOURCE_ID" type="INTEGER" required="false" references="RHQ_RESOURCE"/>
        <column name="DRIFT_DEFINITION_ID" type="INTEGER" required="false" references="RHQ_DRIFT_DEFINITION"/>
        <!--  the drift handling mode at changeset creation time -->
        <column name="DRIFT_HANDLING_MODE" type="VARCHAR2" size="20" required="true"/>        
    </table>
    
    <!--  A single occurence of drift for a resource (note, this is for the JPA server plugin impl only) -->
    <table name="RHQ_DRIFT">
        <column name="ID" default="sequence-only" initial="10001" primarykey="true" required="true" type="INTEGER"/>
        <column name="CTIME" type="LONG" required="true"/>
        <column name="CATEGORY" type="VARCHAR2" size="20" required="true"/>        
        <column name="DRIFT_SET_ID" type="INTEGER" required="false" references="RHQ_DRIFT_SET"/>
        <column name="DRIFT_CHANGE_SET_ID" type="INTEGER" required="true" references="RHQ_DRIFT_CHANGE_SET"/>
        <!-- the file path not including the base directory -->        
        <column name="PATH" type="VARCHAR2" size="1024" required="true"/>
        <!-- the same as PATH less [/]filename.ext. Redundant storage for the purpose of strict directory search.
             this field can be considered transient for serialization purposes -->
        <column name="PATH_DIRECTORY" type="VARCHAR2" size="1024" required="true"/>        
        <column name="OLD_DRIFT_FILE" type="VARCHAR2" size="64" required="false" references="RHQ_DRIFT_FILE"/>        
        <column name="NEW_DRIFT_FILE" type="VARCHAR2" size="64" required="false" references="RHQ_DRIFT_FILE"/>        
    </table>

    <table name="RHQ_BUNDLE_GROUP">
        <column name="ID" default="sequence-only" initial="10001"
                primarykey="true" required="true" type="INTEGER"/>
        <column name="NAME" required="true" size="4000" type="VARCHAR2"/>
        <column name="DESCRIPTION" size="512" type="VARCHAR2"/>
        <column name="CTIME" type="LONG"/>
        <column name="MTIME" type="LONG"/>
    </table>

    <!-- Many To Many mapping for bundles to bundle groups -->
    <table name="RHQ_BUNDLE_GROUP_BUNDLE_MAP">
        <column name="BUNDLE_ID" required="true" type="INTEGER" references="RHQ_BUNDLE"/>
        <column name="BUNDLE_GROUP_ID" required="true" type="INTEGER" references="RHQ_BUNDLE_GROUP"/>

        <!-- not using full words to fit index name length -->
        <constraint name="RHQ_BUNDLE_GROUP_BUN_MAP_KEY">
            <primaryKey>
                <field ref="BUNDLE_ID"/>
                <field ref="BUNDLE_GROUP_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <!--  this would be better in authz-schema but too early in the chain, so putting it here  -->    
    <table name="RHQ_ROLE_BUNDLE_GROUP_MAP">
        <column name="ROLE_ID" required="true" type="INTEGER" references="RHQ_ROLE"/>
        <column name="BUNDLE_GROUP_ID" required="true" type="INTEGER" references="RHQ_BUNDLE_GROUP"/>

        <constraint name="RHQ_ROLE_BUN_GROUP_MAP_KEY">
            <primaryKey>
                <field ref="ROLE_ID"/>
                <field ref="BUNDLE_GROUP_ID"/>
            </primaryKey>
        </constraint>
    </table>

    <!-- Many to many mapping between resource type and bundle type -
         which bundle types target which resource types? -->
    <table name="RHQ_BUNDLE_TYPE_TARGET_MAP">
        <column name="BUNDLE_TYPE_ID" type="INTEGER" required="true" references="RHQ_BUNDLE_TYPE"/>
        <column name="RESOURCE_TYPE_ID" type="INTEGER" required="true" references="RHQ_RESOURCE_TYPE"/>
    </table>
</dbsetup>

