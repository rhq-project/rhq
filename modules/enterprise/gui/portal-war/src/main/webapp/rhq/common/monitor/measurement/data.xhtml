<?xml version="1.0"?>

<!DOCTYPE html
      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:onf="http://jboss.org/on/function">

<ui:composition>

<script language="JavaScript">

  var baseUrl = "/resource/common/monitor/visibility/IndicatorCharts.do";
  baseUrl += '?';
  baseUrl += "#{onf:contextFragmentURL()}"
  baseUrl += '&amp;view=';
  baseUrl += "#{IndicatorChartsUIBean.view}";

  // Register the remove metric chart method
  ajaxEngine.registerRequest( 'indicatorCharts', baseUrl );

  function removeMetric(token) {
    ajaxEngine.sendRequest(
        'indicatorCharts',
        'metric=' + token,
        'action=remove',
        'view=' + '#{IndicatorChartsUIBean.view}');
    new Effect.Fade(token);
  }

  function moveMetricUp(token) {
    ajaxEngine.sendRequest(
        'indicatorCharts',
        'metric=' + token,
        'action=moveUp',
        'view=' + '#{IndicatorChartsUIBean.view}');
    var root = $('root');
    var elem = $(token);
    moveElementUp(elem, root);
  }

  function moveMetricDown(token) {
    ajaxEngine.sendRequest(
        'indicatorCharts',
        'metric=' + token,
        'action=moveDown',
        'view=' + '#{IndicatorChartsUIBean.view}');
        
    var root = $('root');
    var elem = $(token);
    moveElementDown(elem, root);
  }

</script>

<ul id="root" class="boxy">

<ui:param name="context" value="#{IndicatorChartsUIBean.context}" />
<c:forEach var="metric" varStatus="status" items="#{IndicatorChartsUIBean.data}">

  <li id="#{metric.metricToken}">
  <table width="100%" border="0" cellpadding="2">
  <tr>
    <td>
      <table width="100%" border="0" cellpadding="0" cellspacing="1" style="margin-top: 1px; margin-bottom: 1px;">
        <tr>
          <td>
          <rich:panel styleClass="BlockContentNoPadding" style="border: 0;">
          <font class="BoldText">
          <h:outputLink target="_top" value="/resource/common/monitor/Visibility.do">
             <f:param name="m" value="#{metric.definitionId}"/>
             <c:choose>
                <c:when test="#{context.resourceTypeId > 0}">
                   <f:param name="mode" value="chartSingleMetricMultiResource"/>
                   <f:param name="type" value="#{context.resourceTypeId}"/>
                   <f:param name="parent" value="#{context.parentResourceId}"/>
                </c:when>
                <c:when test="#{context.groupId > 0}">
                   <f:param name="mode" value="chartSingleMetricMultiResource"/>
                   <f:param name="groupId" value="#{context.groupId}"/>
                </c:when>
                <c:otherwise>
                   <f:param name="mode" value="chartSingleMetricSingleResource"/>
                   <f:param name="id" value="#{context.resourceId}"/>
                </c:otherwise>
             </c:choose>
             <h:outputText value="#{metric.label} " />
          </h:outputLink>
          </font>
             <rich:toolTip followMouse="true" showDelay="500">
                <h:outputText value="#{metric.description}" rendered="#{not empty metric.description}" />
                <h:outputText value="No description of this metric available" rendered="#{empty metric.description}" />
             </rich:toolTip>
          </rich:panel>
          </td>

          <td width="400">
             <table cellpadding="0" cellspacing="0" border="0" width="100%">
             <tr>
             <td width="33%" nowrap="nowrap">
                <h:outputFormat style="font-weight: bold;" value="#{msg['resource.common.monitor.visibility.LowTH']}" />: 
                <h:outputText value="#{metric.minMetric.valueFmt}"/>
             </td>
             
             <td width="34%" nowrap="nowrap">
                <h:outputFormat style="font-weight: bold;" value="#{msg['resource.common.monitor.visibility.AvgTH']}" />: 
                <h:outputText value="#{metric.avgMetric.valueFmt}"/>
             </td>
             
             <td width="33%" nowrap="nowrap">
                <h:outputFormat style="font-weight: bold;" value="#{msg['resource.common.monitor.visibility.PeakTH']}" />: 
                <h:outputText value="#{metric.maxMetric.valueFmt}"/>
             </td>
             </tr>
             </table>
          </td>

          <td width="1">
             <a href="javascript:moveMetricUp('#{metric.metricToken}')">
                <img src="/images/dash_icon_up.gif" border="0"/>
             </a>
          </td>

          <td width="1">
             <a href="javascript:moveMetricDown('#{metric.metricToken}')">
                <img src="/images/dash_icon_down.gif" border="0"/>
             </a>
          </td>
          
          <td width="1">
             <a href="javascript:removeMetric('#{metric.metricToken}')">
                <img src="/images/dash-icon_delete.gif" border="0"/>
             </a>
          </td>
          
        </tr>
        <c:if test="#{not empty metric.metricSource}">
        <tr>
           <td colspan="7">
              <img src="/images/hierarchy.gif" />
              <font class="FooterSmall">
                 <h:outputLink target="_top" value="/rhq/resource/monitor/graphs.xhtml">
                    <f:param name="id" value="#{metric.metricSourceId}" />
                    <h:outputFormat value="#{msg['common.value.parenthesis']}">
                       <f:param value="#{metric.metricSource}" />
                    </h:outputFormat>
                 </h:outputLink>
              </font>
           </td>
        </tr>
        </c:if>
      </table>
    </td>
  </tr>
  </table>
  
  <img src="/resource/HighLowChart?#{onf:contextFragmentURL()}&amp;imageWidth=647&amp;imageHeight=100&amp;schedId=#{metric.scheduleId}&amp;definitionId=#{metric.definitionId}&amp;now=#{IndicatorViewsForm.timeToken}&amp;measurementUnits=#{metric.units}"
       width="647" height="100" />

  </li>
</c:forEach>

</ul>

</ui:composition>

</html>