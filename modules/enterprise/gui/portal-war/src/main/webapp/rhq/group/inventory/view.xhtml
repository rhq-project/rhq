<?xml version="1.0"?>

<!DOCTYPE html
      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:onf="http://jboss.org/on/function"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<ui:composition template="/rhq/group/layout/main.xhtml">

<ui:param name="pageTitle" value="#{ResourceGroupUIBean.groupCategoryName} '#{ResourceGroupUIBean.name}' - Inventory Data"/>
<ui:param name="selectedTabName" value="Inventory"/>

<ui:define name="content">

<!-- ===================   SHARED PARAMS    =================== -->

<ui:param name="resourceGroupMembersDataModel" value="#{ListResourceGroupMembersUIBean.dataModel}"/>

<!-- =================== GENERAL PROPERTIES =================== -->
<rich:panel styleClass="BlockContent">

   <f:facet name="header" styleClass="BlockTitle">
      General Properties
   </f:facet>

   <h:panelGrid columns="2" styleClass="general-props-table" columnClasses="general-prop-cell">
   
      <h:panelGroup layout="block">
         <b>Name: </b> #{ResourceGroupUIBean.name}
      </h:panelGroup>
      
      <h:panelGroup layout="block">
         <b>Date Created: </b>
         <h:outputText value="#{ResourceGroupUIBean.ctime}">
            <f:converter converterId="UserDateTimeConverter" />
         </h:outputText>
      </h:panelGroup>
      
      <h:panelGroup layout="block">
         <h:outputText value="Description: " styleClass="BoldText"/>
         <h:outputText value="#{ResourceGroupUIBean.description}" rendered="#{!empty ResourceGroupUIBean.description}"/>
         <h:outputText value="none" style="font-style: italic" rendered="#{empty ResourceGroupUIBean.description}"/>
      </h:panelGroup>
      
      <h:panelGroup layout="block">
         <b>Date Last Modified: </b>
         <h:outputText value="#{ResourceGroupUIBean.mtime}">
            <f:converter converterId="UserDateTimeConverter" />
         </h:outputText>
      </h:panelGroup>
      
      <h:panelGroup layout="block">
         <b>Category: </b> #{ResourceGroupUIBean.groupCategoryName}
      </h:panelGroup>

      <h:panelGroup layout="block">
         <b>Last Modified By: </b> #{ResourceGroupUIBean.modifiedBy.firstName} #{ResourceGroupUIBean.modifiedBy.lastName}
         (<a href="mailto:#{ResourceGroupUIBean.modifiedBy.emailAddress}">#{ResourceGroupUIBean.modifiedBy.name}</a>)
      </h:panelGroup>

      <h:panelGroup layout="block">
         <b>Recursive: </b> #{ResourceGroupUIBean.recursive}
      </h:panelGroup>
      
      <h:panelGroup layout="block" rendered="#{!empty ResourceGroupUIBean.groupDefinition}" >
         <b>Group Definition: </b>
         <h:outputLink value="/rhq/definition/group/view.xhtml">
            <f:param name="groupDefinitionId" value="#{ResourceGroupUIBean.groupDefinition.id}"/>
            <h:outputText value="#{ResourceGroupUIBean.groupDefinition.name}"/>
        </h:outputLink>
      </h:panelGroup>
      
   </h:panelGrid>

   <h:form id="viewGeneralPropertiesForm">

      <input type="hidden" name="groupId" value="#{ResourceGroupUIBean.groupId}"/>
      <input type="hidden" name="category" value="#{param.category}"/>

      <h:panelGrid columns="1" styleClass="buttons-table" columnClasses="button-cell"
                   rendered="#{ResourceGroupUIBean.permissions.inventory}">
         <h:commandButton value="EDIT..." action="#{EditGroupGeneralPropertiesUIBean.begin}"
                          title="Edit General Properties" styleClass="buttonmed"
                          rendered="#{empty ResourceGroupUIBean.groupDefinition}" />
         <h:outputText    value="*DynaGroup general properties are managed, and are thus uneditable directly"
                          rendered="#{!empty ResourceGroupUIBean.groupDefinition}" />
      </h:panelGrid>

   </h:form>

</rich:panel>

<!-- =================== RESOURCE TYPE COUNTS =================== -->

<rich:panel styleClass="BlockContent"
            rendered="#{resourceGroupMembersDataModel.rowCount > 0}">

<f:facet name="header" styleClass="BlockTitle">
   <a name="ResourceTypeCounts"/>
   Resource Type Counts
</f:facet>

<ui:param name="resourceTypeCounts" value=""/>

<rich:dataGrid columns="2"
               value="#{ListResourceGroupMembersUIBean.resourceTypeCounts}" 
               var="resourceTypeCountTuple">

   <h:panelGroup layout="block" width="45%">
      <h:outputText value="#{resourceTypeCountTuple.lefty}" /> (<h:outputText value="#{resourceTypeCountTuple.righty}" />)
   </h:panelGroup>
   
</rich:dataGrid>

</rich:panel>

<!-- =================== RESOURCE GROUP MEMBERS =================== -->
<rich:panel styleClass="BlockContent">

<f:facet name="header" styleClass="BlockTitle">
   <a name="GroupMembers"/>
   Group Members
</f:facet>

<h:form id="groupMembersForm">

<input type="hidden" name="groupId" value="#{ResourceGroupUIBean.groupId}"/>
<input type="hidden" name="category" value="#{param.category}"/>

<h:panelGrid columns="2" cellspacing="3" rendered="#{ResourceGroupUIBean.recursive}">
   <h:outputLabel for="suppressRecursiveResults" value="Suppress Recursive Results: " />
   <h:selectBooleanCheckbox id="suppressRecursiveResults" value="#{ListResourceGroupMembersUIBean.suppressRecursiveResults}" >
       <a4j:support event="onchange" reRender="resourceGroupMembersDataTable, resourceGroupMembersDataTableScroller"/>
   </h:selectBooleanCheckbox>
</h:panelGrid>

<br/>

<rich:dataTable id="resourceGroupMembersDataTable"
                binding="#{ListResourceGroupMembersUIBean.dataTable}"
                rows="#{PageControl.ResourceGroupMemberList.pageSize}"
                value="#{resourceGroupMembersDataModel}"
                var="resourcWithAvailability"
                styleClass="resources-table"
                columnClasses="resource-checkbox, resource-quicknav-cell, resource-name-cell, resource-category-cell, resource-type-cell, resource-description-cell, resource-availability-cell"
                columnsWidth="1%,1%"
                headerClass="tableRowHeader"
                footerClass="on-pager-footer">

   <f:facet name="PageControlView">
      <onc:paginationControl id="ResourceGroupMemberList"/>
   </f:facet>

   <rich:column>
      <f:facet name="header">
         <onc:allSelect target="selectedResources" />
      </f:facet>
      
      <onc:select name="selectedResources" value="#{resourcWithAvailability.resource.id}" 
                  rendered="#{resourcWithAvailability.explicit}"/>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <h:outputText styleClass="headerText" value="Quick Links"/>
      </f:facet>

      <onc:quickNav>
         <f:param name="id" value="#{resourcWithAvailability.resource.id}"/>

         <onc:icon name="m" 
                   url="/rhq/resource/monitor/graphs.xhtml" 
                   alt="Monitor"
                   visible="#{monitorEnabled}">
         </onc:icon>

         <onc:icon name="i" 
                   url="/rhq/resource/inventory/view.xhtml" 
                   alt="Inventory"/>

         <onc:icon name="c" 
                   url="/rhq/resource/configuration/view.xhtml" 
                   alt="Configure" 
                   visible="#{resourcWithAvailability.resourceFacets.configuration}"/>

         <onc:icon name="o" 
                   url="/rhq/resource/operation/resourceOperationScheduleNew.xhtml" 
                   alt="Operations" 
                   visible="#{resourcWithAvailability.resourceFacets.operation}"/>

         <onc:icon name="a" 
                   url="/rhq/resource/alert/listAlertDefinitions.xhtml" 
                   alt="Alerts" 
                   visible="#{monitorEnabled}"/>

         <onc:icon name="p" 
                   url="/rhq/resource/content/view.xhtml" 
                   alt="Packages"
                   visible="#{resourcWithAvailability.resourceFacets.content}"/>
         
         <!--  Is this necessary? It's being passed for all quick nav urls. -->   
         <f:param name="mode" value="list"/>

      </onc:quickNav>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <onc:sortableColumnHeader sort="res.name">
            <h:outputText styleClass="headerText" value="Name"/>
         </onc:sortableColumnHeader>
      </f:facet>

      <h:outputLink value="/rhq/resource/monitor/graphs.xhtml">
         <f:param name="id" value="#{resourcWithAvailability.resource.id}"/>
         <h:outputText value="#{resourcWithAvailability.resource.name}"/>
      </h:outputLink>
   </rich:column>

   <rich:column >
      <f:facet name="header">
         <onc:sortableColumnHeader sort="parent.name">
            <h:outputText styleClass="headerText" value="Parent"/>
         </onc:sortableColumnHeader>
      </f:facet>

      <h:outputLink value="/rhq/resource/monitor/graphs.xhtml">
         <f:param name="id" value="#{resourcWithAvailability.parent.id}"/>
         <h:outputText value="#{resourcWithAvailability.parent.name}"/>
      </h:outputLink>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <onc:sortableColumnHeader sort="res.resourceType.category">
            <h:outputText styleClass="headerText" value="Category"/>
         </onc:sortableColumnHeader>
      </f:facet>

      <h:outputText value="#{resourcWithAvailability.resource.resourceType.category}"/>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <onc:sortableColumnHeader sort="res.resourceType.name">
            <h:outputText styleClass="headerText" value="Type"/>
         </onc:sortableColumnHeader>
      </f:facet>

      <h:outputText value="#{resourcWithAvailability.resource.resourceType.name}"/>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <h:outputText styleClass="headerText" value="Description"/>
      </f:facet>

      <h:outputText value="#{resourcWithAvailability.resource.description}"/>
   </rich:column>

   <rich:column>
      <f:facet name="header">
         <onc:sortableColumnHeader sort="a.availabilityType">
            <h:outputText styleClass="headerText" value="Availability"/>
         </onc:sortableColumnHeader>
      </f:facet>

      <h:graphicImage value="/images/icon_available_green.png" alt="Up" title="Up"
                      rendered="#{resourcWithAvailability.availability == 'UP'}"/>
      <h:graphicImage value="/images/icon_available_red.png" alt="Down" title="Down"
                      rendered="#{resourcWithAvailability.availability == 'DOWN'}"/>
      <h:graphicImage value="/images/icon_available_grey.png" alt="Unknown" title="Unknown"
                      rendered="#{resourcWithAvailability.availability == null}"/>
   </rich:column>

   <f:facet name="footer">
      <rich:columnGroup>
         <rich:column colspan="8" width="100%">
         
            <h:commandButton action="#{ListResourceGroupMembersUIBean.addNewResources}"
                             value="ADD TO GROUP"
                             styleClass="on-pager-button buttonsmall" 
                             rendered="#{GlobalPermissionsUIBean.inventory}" />

            <onc:selectCommandButton action="#{DeleteResourcesFromGroupUIBean.removeSelectedResources}"
                                     value="REMOVE FROM GROUP" target="selectedResources"
                                     styleClass="on-pager-button buttonsmall" 
                                     rendered="#{GlobalPermissionsUIBean.inventory}" />
            
            <ui:param name="paginationDataTableName" value="resourceGroupMembersDataTable"/>
            <ui:param name="paginationDataModel" value="#{resourceGroupMembersDataModel}"/>
            <ui:param name="paginationPageControl" value="#{PageControl.ResourceGroupMemberList}"/>
            <ui:include src="/rhq/resource/include/pagination.xhtml" />

         </rich:column>
      </rich:columnGroup>
   </f:facet>

</rich:dataTable>

</h:form>

</rich:panel>

<!-- =================== GROUP CONNECTION PROPERTIES =================== -->
<rich:panel styleClass="BlockContent"
            rendered="#{resourceGroupMembersDataModel.rowCount > 0 and
                        ResourceGroupUIBean.groupCategoryName == 'COMPATIBLE' and
                        !empty ViewGroupConnectionPropertiesUIBean.configurationDefinition.propertyDefinitions and
                        !empty ViewGroupConnectionPropertiesUIBean.configuration.map}">


   <f:facet name="header" styleClass="BlockTitle">
      Group Connection Properties
   </f:facet>

   <h:form id="viewGroupConnectionPropertiesForm">

      <input type="hidden" name="groupId" value="#{ResourceGroupUIBean.groupId}"/>
      <input type="hidden" name="category" value="#{param.category}"/>

      <onc:config configurationDefinition="#{ViewGroupConnectionPropertiesUIBean.configurationDefinition}"
                  configuration="#{ViewGroupConnectionPropertiesUIBean.configuration}"
                  readOnly="true"
                  nullConfigurationDefinitionMessage="#{ViewGroupConnectionPropertiesUIBean.nullConfigurationDefinitionMessage}"
                  nullConfigurationMessage="#{ViewGroupConnectionPropertiesUIBean.nullConfigurationMessage}"
                  prevalidate="true" />

      <h:panelGrid columns="2" styleClass="buttons-table" columnClasses="button-cell"
                   rendered="#{ResourceGroupUIBean.permissions.inventory}">
         <h:commandButton value="EDIT..." action="#{EditGroupConnectionPropertiesUIBean.begin}"
                          title="Edit Connection Properties" styleClass="buttonmed"/>
         <h:commandButton value="VIEW HISTORY" action="#{ViewGroupConnectionPropertyHistoryUIBean.begin}"
                          title="View History for Group Connection Property Updates" styleClass="buttonmed"/>
      </h:panelGrid>

   </h:form>

</rich:panel>

</ui:define>

</ui:composition>

</html>
