<?xml version="1.0"?>

<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtResourcesTree.xhtmlml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:onc="http://jboss.org/on/component">

<body>

<f:subview id="navigationTreeView">
    <ui:composition>

        <h:form id="leftNavGroupTreeForm"> <!-- datascroll tag wants a form to be present -->
            <h:panelGroup id="leftTreeHolder">

                <input type="hidden" name="groupId" value="#{param.groupId}"/>
                <input type="hidden" name="parentGroupId" value="#{param.parentGroupId}"/>

                <a4j:region renderRegionOnly="true">

                    <a4j:outputPanel id="messagePanel" layout="block" ajaxRendered="true" style="width: 100%;">
                        <h:message for="leftNavGroupTree" showSummary="true" showDetail="false"  style="background-color: yellow;"/>
                    </a4j:outputPanel>


                    <f:facet name="header">
                        Server Resources (in single element pages)
                    </f:facet>


                    <ui:param name="clusterSize" value="#{ResourceGroupTreeModelUIBean.roots[0].members.size}"/>

                    <!--stateAdvisor="#{ResourceTreeStateAdvisor}"-->
                    <rich:tree style="width: 100%; height: 100%" switchType="ajax"
                               id="leftNavGroupTree"
                               var="treeNode"
                               stateAdvisor="#{ResourceGroupTreeStateAdvisor}"
                               nodeSelectListener="#{ResourceGroupTreeStateAdvisor.nodeSelectListener}"
                               adviseNodeSelected="#{ResourceGroupTreeStateAdvisor.adviseNodeSelected}"
                               ajaxSubmitSelection="true"
                               status="commonStatus"
                               icon="/images/icons/Platform_16.png"
                               nodeFace="#{treeNode.data.class.simpleName}">

                        <rich:recursiveTreeNodesAdaptor roots="#{ResourceGroupTreeModelUIBean.roots}"
                                                        var="groupTreeItem"
                                                        nodes="#{groupTreeItem.children}">


                        </rich:recursiveTreeNodesAdaptor>


                        <rich:treeNode type="ResourceGroup"
                                       icon="/images/icons/Cluster_up_16.png"
                                       iconLeaf="/images/icons/Cluster_up_16.png">

                            <a4j:support event="oncontextmenu" reRender="resourceMenu" timeout="5000"
                                         disableDefault="true" status="commonStatus" limitToList="true"
                                         ajaxSingle="true">

                                <f:param name="contextGroupId" value="#{groupTreeItem.data.id}"/>
                                <f:param name="contextParentGroupId" value="#{groupTreeItem.data.id}"/>


                                <rich:componentControl disableDefault="true" event="oncomplete" for="resourceMenu"
                                                       operation="show">
                                    <f:param name="contextGroupId" value="#{groupTreeItem.data.id}"/>
                                </rich:componentControl>
                            </a4j:support>

                            <h:outputText value="#{groupTreeItem.data.name}"/>

                        </rich:treeNode>

                        <rich:treeNode type="AutoGroupComposite"
                                       iconLeaf="/images/icons/#{groupTreeItem.data.subcategory != null ? 'Subcategory' : 'Auto_group'}_16.png"
                                       icon="/images/icons/#{groupTreeItem.data.subcategory != null ? 'Subcategory' : 'Auto_group'}_16.png" >

                            <h:outputText
                                    value="#{groupTreeItem.data.subcategory == null ? groupTreeItem.data.resourceType.name : groupTreeItem.data.subcategory.name}"/>

                            <!-- Tree Node supporting context menu -->
                        </rich:treeNode>

                        <rich:treeNode type="ClusterKey"
                                       icon="/images/icons/Cluster_up_16.png"
                                       iconLeaf="/images/icons/Cluster_up_16.png">

                            <a4j:support event="oncontextmenu" reRender="resourceMenu" timeout="5000"
                                         disableDefault="true" status="commonStatus" limitToList="true"
                                         ajaxSingle="true">

                                <f:param name="contextClusterKey" value="#{groupTreeItem.data.key}"/>
                                <f:param name="contextParentGroupId" value="#{param.parentGroupId == null ? param.groupId : param.parentGroupId}"/>

                                <rich:componentControl disableDefault="true" event="oncomplete" for="resourceMenu"
                                                       operation="show">
                                    <f:param name="clusterKey" value="#{groupTreeItem.data}"/>
                                </rich:componentControl>
                            </a4j:support>

                            <h:outputText value="#{groupTreeItem.members[0]}"/>
                            <h:outputText value=" (#{groupTreeItem.members.size} / #{clusterSize})"
                                          rendered="#{groupTreeItem.members.size lt clusterSize}"
                                    style="color: red;"/>

                        </rich:treeNode>


                        <rich:treeNode type="Resource"
                                       icon="/images/icons/#{groupTreeItem.data.resourceType.category}_#{groupTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'down' : 'up'}_16.png"
                                       iconLeaf="/images/icons/#{groupTreeItem.data.resourceType.category}_#{groupTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'down' : 'up'}_16.png">

                            <h:outputText value="#{groupTreeItem}"/>
                        </rich:treeNode>

                    </rich:tree>


                    <!--<a4j:log popup="false" level="WARN" style="width: 800px; height: 300px;"></a4j:log>-->

                    <a4j:outputPanel layout="none" id="contextMenuPanel">

                        <h:panelGroup id="contentMenuPanelGroup">

                            <!-- TODO: Implement GroupTreeContextMenuUIBean. -->
                            <rich:contextMenu attached="false" id="resourceMenu"
                                              binding="#{ResourceGroupTreeContextMenuUIBean.menu}"
                                              disableDefaultMenu="false" style="z-index: 50;" >

                            </rich:contextMenu>

                        </h:panelGroup>
                    </a4j:outputPanel>


                </a4j:region>

            </h:panelGroup>


        </h:form>

        <f:verbatim>
            <script type="text/javascript">

                Event.observe("#{rich:clientId('leftTreeHolder')}", "contextmenu", Event.stop);
            </script>
        </f:verbatim>

    </ui:composition>

</f:subview>


</body>

</html>
