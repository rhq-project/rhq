<?xml version="1.0"?>

<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:onc="http://jboss.org/on/component">

<body>


Usage: The following parameters must be set in the calling page

paginationDataTableName - Name of the data table to be controlled
paginationDataModel - Data model of the underlying table being controlled (used for total row count)
paginationPageControl - Page control value to set when changing the number of rows per page
<f:subview id="navigationTreeView">
<ui:composition>

    <h:form id="leftNavTreeForm"> <!-- tree needs a form to be present -->

        <input type="hidden" name="id" value="#{param.id}"/>
        <input type="hidden" name="parent" value="#{param.parent}"/>
        <input type="hidden" name="type" value="#{param.type}"/>

        <a4j:region renderRegionOnly="true">
               
          <a4j:outputPanel ajaxRendered="true">
             <h:outputText value="#{ResourceUIBean.message}" />
          </a4j:outputPanel>

            <h:form id="leftNavResourceTreeForm">


                <rich:tree style="width: 100%; height: 100%; " switchType="ajax"
                           stateAdvisor="#{ResourceTreeStateAdvisor}"
                           status="commonStatus"
                           var="treeNode"
                           icon="/images/icn_tree_Platform.gif"
                           id="leftNavTree"
                           preserveDataInRequest="false"
                           adviseNodeSelected="#{ResourceTreeStateAdvisor.adviseNodeSelected}"
                           changeExpandListener="#{ResourceTreeStateAdvisor.changeExpandListener}"
                           nodeSelectListener="#{ResourceTreeStateAdvisor.nodeSelectListener}"
                           ajaxSubmitSelection="true"
                           nodeFace="#{treeNode.data.class.simpleName}">
                    <rich:recursiveTreeNodesAdaptor roots="#{ResourceTreeModelUIBean.roots}" var="resourceTreeItem"
                                                    nodes="#{resourceTreeItem.children}">


                    </rich:recursiveTreeNodesAdaptor>

                    <rich:treeNode type="AutoGroupComposite"
                                   iconLeaf="/images/icn_tree_folder.gif" icon="/images/icn_tree_folder.gif">

                        <h:outputText value="#{resourceTreeItem}" styleClass="availLink#{resourceTreeItem.data.availability == 0 ? 'Down' : resourceTreeItem.data.availability == 1 ? 'Up' : 'Mixed'}"/>

                    </rich:treeNode>


                    <rich:treeNode type="LockedResource"
                                   icon="/images/lock_16.png"
                                   iconLeaf="/images/lock_16.png">

                        <h:outputText value="#{resourceTreeItem}"
                                       styleClass="availLink#{resourceTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'Down' : 'Up' }"/>

                    </rich:treeNode>

                    <rich:treeNode type="Resource"
                                   icon="/images/icn_tree_#{resourceTreeItem.data.resourceType.category}_#{resourceTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'off' : 'on'}.png"
                                   iconLeaf="/images/icn_tree_#{resourceTreeItem.data.resourceType.category}_#{resourceTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'off' : 'on'}.png">


                        <a4j:support event="oncontextmenu"  reRender="resourceMenu" timeout="5000"
                                     disableDefault="true" status="commonStatus" limitToList="true"
                                     ajaxSingle="true">
                            <f:param name="contextResourceId" value="#{resourceTreeItem.data.id}"/>
                            <f:param name="contextResourceTypeId" value="#{resourceTreeItem.data.resourceType.id}"/>

                            <rich:componentControl disableDefault="true" event="oncomplete" for="resourceMenu"
                                                   operation="show">
                                <f:param value="#{resourceTreeItem.data.name}" name="name"/>
                                <f:param value="#{resourceTreeItem.data.id}" name="id"/>
                                <f:param value="#{resourceTreeItem.data.resourceType.name}" name="type"/>
                                <f:param value="'#{resourceTreeItem.data.resourceType.operationDefinitions}'"
                                         name="ops"/>
                            </rich:componentControl>
                        </a4j:support>



                            <h:outputText value="#{resourceTreeItem}"
                                          styleClass="availLink#{resourceTreeItem.data.currentAvailability.availabilityType == 'DOWN' ? 'Down' : 'Up' }"/>

                    </rich:treeNode>


                </rich:tree>


            </h:form>

       <!-- </a4j:region>

        <a4j:region id="menuOnly" renderRegionOnly="true" selfRendered="true">
-->
            <!-- This can be useful for debugging ajax update problems -->
            <!--<a4j:log popup="false" level="WARN" style="width: 800px; height: 300px;"></a4j:log>-->


            <rich:contextMenu attached="false" id="resourceMenu" binding="#{ResourceTreeModelUIBean.menu}"
                              disableDefaultMenu="true" style="z-index: 25;">

            </rich:contextMenu>

    </a4j:region>

    </h:form>

</ui:composition>

</f:subview>

</body>

</html>
