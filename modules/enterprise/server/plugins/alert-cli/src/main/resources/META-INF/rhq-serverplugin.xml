<?xml version="1.0" encoding="UTF-8" ?>

<alert-plugin
        name="alert-cli"
        displayName="Alert:CLI"
        xmlns="urn:xmlns:rhq-serverplugin.alert"
        xmlns:c="urn:xmlns:rhq-configuration"
        xmlns:serverplugin="urn:xmlns:rhq-serverplugin"
        package="org.rhq.enterprise.server.plugins.alertCli"
        description="Alert sender plugin that can execute a CLI script."
        >

    <serverplugin:help>
        Used to execute a CLI script.
    </serverplugin:help>

    <serverplugin:plugin-component class="CliComponent">
        <serverplugin:control name="checkAlertsValidity">
            <serverplugin:results>
                <c:list-property name="misconfiguredAlertDefs" displayName="Misconfigured Alert Definitions">
                    <c:description>
                        Alert scripts run authenticated as a user specified in their definitions. If a user is deleted, 
                        the alert definition will contain invalid reference to that user and needs to be update manually. 
                        This operation returns a list of such misconfigured alert definitions.
                    </c:description>
                    <c:map-property name="alertDefinition">
                        <c:simple-property name="alertDefinitionId" />
                        <c:simple-property name="alertDefinitionName" />
                        <c:simple-property name="resourceId" />
                        <c:simple-property name="resourcePath" />
                    </c:map-property>
                </c:list-property>
            </serverplugin:results>
        </serverplugin:control>
        
        <serverplugin:control name="reassignAlerts" description="Re-assign alerts to run as different users">
            <serverplugin:parameters>
                <c:simple-property name="userName" displayName="User Name" description="The name of the user to re-assign the alerts to." />
                <c:simple-property name="alertDefIds" displayName="Alert Definition IDs" required="false">
                    <c:description>
                        The comma-separated list of the alert definition ids to re-assign.
                        If left empty, all the alert definitions with the CLI notifications that have
                        an invalid user assigned, will be re-assigned to the provided user.
                    </c:description>
                    <c:constraint><c:regex-constraint expression="(\d+(\s*,\s*\d+)*)?"/></c:constraint>
                </c:simple-property>
            </serverplugin:parameters>
        </serverplugin:control>
    </serverplugin:plugin-component>

    <serverplugin:plugin-configuration>
        <c:simple-property name="uploadRepoName" displayName="Repo to manually upload scripts to" required="true" default="Uploaded Scripts">
            <c:description>
                When manually uploading a script while defining an alert notification, the script will be stored in this repo.
            </c:description>
        </c:simple-property>
        <c:list-property name="packageTypes" displayName="Package Types" required="true">
            <c:description>
                The list of package types that will be considered scripts. Any package of those types in any repo will be 
                considered a script and will be available for choosing as an alert script.
            </c:description> 
            <c:simple-property name="packageType" displayName="Package Type" type="string" required="true"/>
        </c:list-property>
    </serverplugin:plugin-configuration>
    
    <!-- How does this sender show up in drop downs etc -->
    <short-name>CLI Script</short-name>

    <!-- Class that does the actual sending -->
    <plugin-class>CliSender</plugin-class>

    <alert-configuration>
        <c:simple-property name="packageId" type="integer" required="true" description="The id of the package containing the script to execute."/>
        <c:simple-property name="userId" type="integer" required="true" description="The user the script will be run as."/>
    </alert-configuration>
</alert-plugin>