<?xml version="1.0"?>
<plugin name="Cassandra"
        displayName="Cassandra"
        description="Monitor and manage a Cassandra node"
        package="org.rhq.plugins.cassandra"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">

  <depends plugin="JMX" useClasses="true"/>

  <server name="Cassandra Node" discovery="CassandraNodeDiscoveryComponent" class="CassandraNodeComponent">
    <plugin-configuration>
      <c:simple-property
          name="connectorAddress"
          displayName="Manager URL"
          description="The RMI URL with which to connect to the Cassandra node (e.g. service:jmx:rmi:///jndi/rmi://localhost:7199/jmxrmi)."
          default="service:jmx:rmi:///jndi/rmi://localhost:7199/jmxrmi"/>
      <c:simple-property
          name="type"
          description="The type used to establish the EMS connection to the Cassandra node."
          default="org.mc4j.ems.connection.support.metadata.J2SE5ConnectionTypeDescriptor"
          readOnly="true"/>
      <c:simple-property name="installURI" required="false" type="string" description="The installation path for the selected server type which will be used to find client libraries (if appropriate)"/>
      <c:simple-property name="principal" required="false" description="The login principal/username"/>
      <c:simple-property name="credentials" required="false" type="password" description="The login credentials/password"/>
      <c:simple-property name="additionalClassPathEntries" required="false" type="string" description="Comma-separated list of directories and filenames that contain resources and classes needed to communicate with the JMX Server and its MBeans. If you specify 'some/directory/*.jar', all jars found in the given directory will be added."/>
      <c:simple-property name="commandLine" required="false" type="string" description="the command line of the JVM at the time it was discovered - only used by JVMs with type Local; if the command line of the JVM changes, this property's value will need to be updated accordingly in order for RHQ to connect to the JVM"/>
    </plugin-configuration>

    <process-scan name="CassandraDaemon"
                  query="process|basename|match=^java.*,arg|org.apache.cassandra.service.CassandraDaemon|match=.*"/>

    <!--<server name="Cassandra JVM"-->
            <!--description="The JVM of the Cassandra node"-->
            <!--sourcePlugin="JMX"-->
            <!--sourceType="JMX Server"-->
            <!--discovery="org.rhq.plugins.jmx.EmbeddedJMXServerDiscoveryComponent"-->
            <!--class="org.rhq.plugins.jmx.EmbeddedJMXServerComponent"-->
            <!--singleton="true">-->
      <!--</server>-->

    <service name="StorageProxy"
             discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
             class="org.rhq.plugins.jmx.MBeanResourceComponent">
      <plugin-configuration>
        <c:simple-property name="objectName" readOnly="true" default="org.apache.cassandra.db:type=StorageProxy"/>
      </plugin-configuration>

      <resource-configuration>
        <c:simple-property name="readOperations" type="long" readOnly="true"/>
      </resource-configuration>
    </service>

    <service name="StorageService"
             discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
             class="org.rhq.plugins.jmx.MBeanResourceComponent">
      <plugin-configuration>
        <c:simple-property name="objectName" readOnly="true" default="org.apache.cassandra.db:type=StorageService"/>
      </plugin-configuration>
      
      <operation name="startRPCServer" description="Start the Thrift server"/>

      <operation name="stopRPCServer" description="Stop the Thrift server"/>

      <!--<operation name="takeSnapshot"-->
                 <!--description="Takes the snapshot for the given tables. A snapshot name must be specified.">-->
        <!--<parameters>-->
          <!--<c:simple-property name="p1" displayName="tag" required="true" type="string"/>-->
          <!--<c:list-property name="p2" displayName="columnFamilies">-->
            <!--<c:map-property name="columnFamiliesMap">-->
              <!--<c:simple-property name="columnFamily" type="string"/>-->
            <!--</c:map-property>-->
          <!--</c:list-property>-->
        <!--</parameters>-->
      <!--</operation>-->
    </service>
  </server>
</plugin>