<?xml version="1.0" encoding="UTF-8"?>

<!-- 
    <c:simple-property name="time/minute" displayName="Minute" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="[0-9\*][0-9\/,-\*]*"/></c:constraint>
    </c:simple-property>
    <c:simple-property name="time/hour" displayName="Hour" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="[0-9\*][0-9\/,-\*]*"/></c:constraint>
    <c:simple-property>
    <c:simple-property name="time/dayofmonth" displayName="Day of Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="[0-9\*][0-9\/,-\*]*"/></c:constraint>
    </c:simple-property>
    <c:simple-property name="time/month" displayName="Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="[0-9\*][0-9\/,-\*]*|[a-zA-Z]{3}"/></c:constraint>        
    </c:simple-property>
    <c:simple-property name="time/dayofweek" displayName="Day of Week" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="[0-9\*][0-9\/,-\*]*|[a-zA-Z]{3}"/></c:constraint>                   
    </c:simple-property>                   
    <c:simple-property name="user" displayName="Executing user" required="true" description="TODO"/>
    <c:simple-property name="." displayName="Command" required="true" description="TODO"/>
 -->
<!-- 
    <c:simple-property name="time/minute" displayName="Minute" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="&#5B;0-9\*&#5D;&#5B;0-9\/,-\*&#5D;*"/></c:constraint>
    </c:simple-property>
    <c:simple-property name="time/hour" displayName="Hour" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="&#5B;0-9\*&#5D;&#5B;0-9\/,-\*&#5D;*"/></c:constraint>
    </c:simple-property>
    <c:simple-property name="time/dayofmonth" displayName="Day of Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="&#5B;0-9\*&#5D;&#5B;0-9\/,-\*&#5D;*"/></c:constraint>
    </c:simple-property>
    <c:simple-property name="time/month" displayName="Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="&#5B;0-9\*&#5D;&#5B;0-9\/,-\*&#5D;*|&#5B;a-zA-Z&#5D;{3}"/></c:constraint>
    </c:simple-property>                       
    <c:simple-property name="time/dayofweek" displayName="Day of Week" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
        <c:constraint><c:regex-constraint expression="&#5B;0-9\*&#5D;&#5B;0-9\/,-\*&#5D;*|&#5B;a-zA-Z&#5D;{3}"/></c:constraint>
    </c:simple-property>                       
    <c:simple-property name="user" displayName="Executing user" required="false" description="TODO"/>
    <c:simple-property name="." displayName="Command" required="true" description="TODO"/>

 -->
<!DOCTYPE plugin [

<!ENTITY cronEntry '
    <c:simple-property name="time/minute" displayName="Minute" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
    </c:simple-property>
    <c:simple-property name="time/hour" displayName="Hour" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
    </c:simple-property>
    <c:simple-property name="time/dayofmonth" displayName="Day of Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
    </c:simple-property>
    <c:simple-property name="time/month" displayName="Month" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
    </c:simple-property>                       
    <c:simple-property name="time/dayofweek" displayName="Day of Week" type="string" required="true" activationPolicy="immediate"
                       default="*" description="TODO">
    </c:simple-property>                       
    <c:simple-property name="user" displayName="Executing user" required="true" description="TODO"/>
    <c:simple-property name="." displayName="Command" required="true" description="TODO"/>
'>

<!ENTITY cronTabRef '
    <c:simple-property name=".." displayName="Cron Tab" type="string" required="true" description="TODO"/>
'>

]>
<plugin name="Cron"
        displayName="Cron"
        description="Configuration of cron"
        package="org.rhq.plugins.cron"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">

   <depends plugin="Augeas"/>

   <service name="Cron"
            description="The cron configuration"
            discovery="CronDiscoveryComponent"
            class="CronComponent"
            singleton="true">

       <runs-inside>
         <parent-resource-type name="Linux"    plugin="Platforms"/>
         <parent-resource-type name="Solaris"  plugin="Platforms"/>
         <parent-resource-type name="HP-UX"    plugin="Platforms"/>
         <parent-resource-type name="AIX"      plugin="Platforms"/>
         <parent-resource-type name="FreeBSD"  plugin="Platforms"/>
         <parent-resource-type name="Mac OS X" plugin="Platforms"/>
         <parent-resource-type name="Java"     plugin="Platforms"/>
       </runs-inside>

      <plugin-configuration>
		<c:simple-property name="augeasModuleName" displayName="Augeas Module Name" default="Cron" required="true" readOnly="true"
                             description="the name of the Augeas module/lens to use for loading and updating this resource's configuration"/>
        <c:simple-property name="configurationFilesInclusionPatterns" required="true" readOnly="true"
          default="/etc/crontab|/etc/cron.d/*">
          <c:description>A | delimited list of patterns of files to configure.</c:description>
        </c:simple-property>
        <c:simple-property name="configurationFilesExclusionPatterns" required="true" readOnly="true"
            default="*.augnew|*.augsave|*.rpmsave|*.rpmnew|*~">
          <c:description>A | delimited list of patterns of files to exclude from configuration.</c:description>
        </c:simple-property>
      </plugin-configuration>

      <resource-configuration>
         <c:list-property  displayName="Hourly Jobs" readOnly="true" 
            name='entry[time/minute != "*" and time/hour = "*" and time/dayofmonth = "*" and time/month = "*" and time/dayofweek = "*"]'>
            <c:map-property name=".">
               &cronEntry;
               &cronTabRef;
            </c:map-property>
         </c:list-property>
         <c:list-property  displayName="Daily Jobs" readOnly="true" 
            name='entry[time/minute != "*" and time/hour != "*" and time/dayofmonth = "*" and time/month = "*" and time/dayofweek = "*"]'>
            <c:map-property name=".">
               &cronEntry;
               &cronTabRef;
            </c:map-property>
         </c:list-property>
         <c:list-property  displayName="Weekly Jobs" readOnly="true" 
            name='entry[time/minute != "*" and time/hour != "*" and time/dayofmonth = "*" and time/month = "*" and time/dayofweek != "*"]'>
            <c:map-property name=".">
               &cronEntry;
               &cronTabRef;
            </c:map-property>
         </c:list-property>
         <c:list-property  displayName="Monthly Jobs" readOnly="true" 
            name='entry[time/minute != "*" and time/hour != "*" and time/dayofmonth != "*" and time/month = "*" and time/dayofweek = "*"]'>
            <c:map-property name=".">
               &cronEntry;
               &cronTabRef;
            </c:map-property>
         </c:list-property>
         <c:list-property  displayName="Yearly Jobs" readOnly="true" 
            name='entry[time/minute != "*" and time/hour != "*" and time/dayofmonth != "*" and time/month != "*" and time/dayofweek = "*"]'>
            <c:map-property name=".">
               &cronEntry;
               &cronTabRef;
            </c:map-property>
         </c:list-property>
      </resource-configuration>

      <service name="Cron Tab"
               description="A single cron tab file"
               discovery="CronTabDiscoveryComponent"
               class="CronTabComponent"
               createDeletePolicy="both">
        <resource-configuration>
            <c:map-property name="basicSettings" displayName="Basic Environment Settings">
                <c:simple-property name="SHELL" displayName="Shell" default="/bin/sh" required="false"/>
                <c:simple-property name="MAILTO" displayName="Mail To" required="false"/>
                <c:simple-property name="HOME" displayName="Home directory" required="false"/>
                <c:simple-property name="CRON_TZ" displayName="Cron Timezone" required="false"/>
                <c:simple-property name="MLS_LEVEL" displayName="SELinux security context" required="false"/>
            </c:map-property>
            <c:list-property name="entries" displayName="Cron Entries">
                <c:map-property name="entry">
                    &cronEntry;
                </c:map-property>
            </c:list-property>
            
            <c:group name="advanced" displayName="Advanced">
                <c:list-property name="additionalSettings">
                    <c:map-property name="setting">
                        <c:simple-property name="name" required="true" />
                        <c:simple-property name="value" required="true"/>
                    </c:map-property>
                </c:list-property>
            </c:group>
        </resource-configuration>
      </service>
   </service>

</plugin>
