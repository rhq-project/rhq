<?xml version="1.0" encoding="UTF-8" ?>

<plugin
   name="Tomcat"
   displayName="Tomcat Server"
   package="org.jboss.on.plugins.tomcat"
   description="Supports management and monitoring of JBoss EWS or Apache Tomcat5, Tomcat6, Tomcat7"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns="urn:xmlns:rhq-plugin"
   xmlns:c="urn:xmlns:rhq-configuration">

   <depends
      plugin="JMX" />

   <server
      name="Tomcat Server"
      discovery="TomcatDiscoveryComponent"
      class="TomcatServerComponent"
      description="Tomcat Server"
      supportsManualAdd="true">

      <plugin-configuration>
         <c:group
            name="connection"
            displayName="Connection Info">
            <c:simple-property
               name="installationPath"
               displayName="Catalina Home"
               type="directory"
               readOnly="true"
               description="The home directory path of the Tomcat installation." />
            <c:simple-property
               name="catalinaBase"
               displayName="Catalina Base"
               type="directory"
               readOnly="true"
               description="The base directory path of the Tomcat instance. Defaults to Catalina Home." />
            <c:simple-property
               name="connectorAddress"
               displayName="Manager URL"
               description="The RMI URL with which to connect to the Tomcat Server (e.g. service:jmx:rmi:///jndi/rmi://localhost:8999/jmxrmi)."
               default="service:jmx:rmi:///jndi/rmi://localhost:8999/jmxrmi" />
            <c:simple-property
               name="principal"
               required="false"
               description="The name of the principal (i.e. user) to authenticate." />
            <c:simple-property
               name="credentials"
               type="password"
               required="false"
               description="The credentials (i.e. password) that should be used to authenticate the principal." />
         </c:group>

         <c:group
            name="control"
            displayName="Operations">
            <c:simple-property
               name="controlMethod"
               displayName="Control Method"
               type="string"
               required="false"
               default="SCRIPT"
               description="The method used to execute the control operations. When set to RPM the 
                                            system will use a System V init script via the 'service' command. The
                                            script properties will be ignored.">
               <c:property-options>
                  <c:option
                     value="RPM"
                     name="RPM System V init script" />
                  <c:option
                     value="SCRIPT"
                     name="shutdown script" />
               </c:property-options>
            </c:simple-property>

            <c:simple-property
               name="scriptPrefix"
               displayName="Script Prefix"
               type="string"
               required="false"
               description="A prefix applied to script execution commands; this prefix is applied verbatim.
                            The full path of the executable is required (e.g. /usr/bin/sudo). For applicable platforms,
                            this is typically a sudo command, so a sudo user must be configured appropriately for the specified command.
                            Ignored if not set."/>
            <c:simple-property
               name="startScript"
               displayName="Start Script"
               type="file"
               required="false"
               description="The path to the script used by the 'Start' operation to start this Tomcat server;
                                            if the path is not absolute it will be resolved relative to {installationPath}." />
            <c:simple-property
               name="shutdownScript"
               displayName="Shutdown Script"
               type="file"
               required="false"
               description="The path to the script used by the 'Shutdown' operation to shutdown this Tomcat server;
                                            if the path is not absolute it will be resolved relative to {installationPath}." />
            
            <c:simple-property name="startWaitMax" required="false"
                              description="The time, in minutes,(e.g. 1 or 8) that must elapse before the server is considered to have failed to start up. The default is 5 minutes.">
                  <c:constraint>
                      <c:integer-constraint minimum="1"/>
                  </c:constraint>
            </c:simple-property>
            <c:simple-property name="stopWaitMax" required="false"
                              description="The time, in minutes,(e.g. 1 or 8) that must elapse before the server is considered to have failed to stop. The default is 2.5 minutes.">
                  <c:constraint>
                      <c:integer-constraint minimum="1"/>
                  </c:constraint>
            </c:simple-property>

            <c:list-property 
                name="startScriptEnvironment" 
                displayName="Start Script Environment Variables" 
                required="false">
                <c:description>
                    Define the environment variables to be set when executing the start script. 
                </c:description>
                <c:map-property name="variable">
                    <c:simple-property name="name" />
                    <c:simple-property name="value" />
                </c:map-property>
            </c:list-property>

            <c:list-property 
                name="shutdownScriptEnvironment" 
                displayName="Shutdown Script Environment Variables" 
                required="false">
                <c:description>
                    Define the environment variables to be set when executing the shutdown script. 
                </c:description>
                <c:map-property name="variable">
                    <c:simple-property name="name" />
                    <c:simple-property name="value" />
                </c:map-property>
            </c:list-property>

            <c:simple-property
               name="serviceName"
               displayName="Service name"
               type="string"
               required="false"
               description="In case of multiple tomcat installations in the same box it is possible
                            to do have several service files like tomcat1, tomcat2 etc.
                            Put here the name you are using."/>
         </c:group>

         <c:group
            name="advanced"
            displayName="Advanced"
            hiddenByDefault="true">
            <c:simple-property
               name="type"
               description="The type used to establish the EMS connection to the Tomcat server."
               default="org.mc4j.ems.connection.support.metadata.Tomcat55ConnectionTypeDescriptor" />
         </c:group>
      </plugin-configuration>

      <!--  This will pick up Tomcat processes, whether standalone or embedded. We narrow it down further by examining the command line -->
      <process-scan
         name="Tomcat"
         query="process|basename|match=^(jsvc.exec|java).*,arg|org.apache.catalina.startup.Bootstrap|match=.*" />

      <!--
         On windows EWS uses the tomcat5.exe, tomcat6.exe and tomcat7.exe executables for starting tomcat. Unlike the normal
         start up scripts, these do specify the command line args for determining catalina.home. See
         https://bugzilla.redhat.com/show_bug.cgi?id=580931 for more details.
      -->
      <process-scan
         name="WindowsEWSTomcat"
         query="process|basename|match=^(T|t)omcat(5|6|7)\.exe"/>

      <operation
         name="start"
         displayName="Start"
         description="Start this Tomcat server. The script used is specified in the Control section of Connection Properties.">
         <results>
            <c:simple-property
               name="operationResult"
               description="Server Start results." />
         </results>
      </operation>

      <operation
         name="shutdown"
         displayName="Shutdown"
         description="Shutdown this Tomcat server. The script used is specified in the Control section of Connection Properties.">
         <results>
            <c:simple-property
               name="operationResult"
               description="Server Shutdown results." />
         </results>
      </operation>

      <operation
         name="restart"
         displayName="Restart"
         description="Restart this Tomcat server. The scripts used are specified in the Control section of Connection Properties.">
         <results>
            <c:simple-property
               name="operationResult"
               description="Server Restart results." />
         </results>
      </operation>

      <operation
         name="storeConfig"
         displayName="Store Configuration"
         description="Save current state to the server.xml file.">
         <results>
            <c:simple-property
               name="operationResult"
               description="Server Store Configuration results." />
         </results>
      </operation>

      <metric
         displayName="Server Identifier"
         property="Catalina:type=Server:serverInfo"
         dataType="trait"
         displayType="summary"
         description="Tomcat server release identifier" />

      <server
         name="Tomcat Server JVM"
         description="JVM of the Tomcat Server"
         sourcePlugin="JMX"
         sourceType="JMX Server"
         discovery="org.rhq.plugins.jmx.EmbeddedJMXServerDiscoveryComponent"
         class="org.rhq.plugins.jmx.EmbeddedJMXServerComponent"
         singleton="true">

        <plugin-configuration>
           <c:simple-property name="type" type="string" default="PARENT" readOnly="true"
                              description="The EMS connection type for this JVM (cannot be modified)"/>
        </plugin-configuration>

      </server>

      <service
         name="Tomcat Virtual Host"
         discovery="TomcatVHostDiscoveryComponent"
         class="TomcatVHostComponent"
         description="A virtual host in the web container"
         createDeletePolicy="both"
         creationDataType="configuration">

         <plugin-configuration>
            <c:group
               name="general"
               displayName="General">

               <c:simple-property
                  name="objectName"
                  readOnly="true"
                  default="Catalina:type=Host,host=%name%" />
            </c:group>

            <c:group
               name="advanced"
               displayName="Advanced"
               hiddenByDefault="true">
               <c:simple-property
                  name="name"
                  type="string"
                  readOnly="true"
                  description="The virtual host" />
               <c:simple-property
                  name="nameTemplate"
                  default="{name}" />
               <c:simple-property
                  name="descriptionTemplate"
                  default="A Tomcat virtual host" />
            </c:group>
         </plugin-configuration>

         <resource-configuration>
            <c:group name="Attributes">
               <c:simple-property
                  name="appBase"
                  required="true"
                  readOnly="true"
                  description="The Application Base directory for this virtual host." />
               <c:simple-property
                  name="autoDeploy"
                  type="boolean"
                  description="Does this host deploy new applications dropped in appBase at runtime?" />
               <c:simple-property
                  name="deployOnStartup"
                  type="boolean"
                  description="Does this host deploy applications in appBase at startup?" />
               <c:simple-property
                  name="deployXML"
                  displayName="Deploy XML"
                  type="boolean"
                  description="deploy Context XML config files?" />
               <c:simple-property
                  name="unpackWARs"
                  displayName="Unpack WARs"
                  type="boolean"
                  description="Does this Host automatically unpack deployed WAR files?" />
               <c:simple-property
                  name="aliases"
                  required="false"
                  type="longString"
                  description="Aliases assigned to the Host. When editing, each alias must be on a new line. Aliases are automatically lowercased." />
            </c:group>
         </resource-configuration>

         <service
            name="Tomcat Web Application (WAR)"
            discovery="TomcatWarDiscoveryComponent"
            class="TomcatWarComponent"
            description="Tomcat deployed Web Application"
            createDeletePolicy="both"
            creationDataType="content">

            <plugin-configuration>
               <c:group name="General">
                  <c:simple-property
                     name="objectName"
                     readOnly="true"
                     default="Catalina:j2eeType=WebModule,name=%name%,J2EEApplication=none,J2EEServer=none" />
                  <c:simple-property
                     name="contextRoot"
                     readOnly="true"
                     required="false"
                     description="The unique path prefix for URLs corresponding to this WAR" />
                  <c:simple-property
                     name="vHost"
                     displayName="Virtual Host"
                     readOnly="true"
                     required="false"
                     description="The (virtual) host for this deployed application. If no host is set, this defaults to 'localhost'" />
                  <c:simple-property
                     name="filename"
                     required="true"
                     readOnly="true"
                     description="The deployment root file name (.war or directory)" />
               </c:group>

               <c:group name="ResponseTime">
                  <c:simple-property
                     name="responseTimeLogFile"
                     required="false"
                     description="the absolute path to the log file containing response-time statistics for this web application" />
                  <c:simple-property
                     name="responseTimeUrlExcludes"
                     required="false"
                     description="a space-delimited list of regular expressions matching URLs to exclude from response-time statisics" />
                  <c:simple-property
                     name="responseTimeUrlTransforms"
                     required="false"
                     description="a space-delimited list of Perl-style substitution expressions to apply to URLs actively collecting response-time statistics (e.g. |^/dept/finance/.*|/dept/finance/*|)" />
               </c:group>

               <c:group
                  name="Advanced"
                  hiddenByDefault="true">
                  <c:simple-property
                     name="name"
                     readOnly="true"
                     description="The name of this Web Module (WAR)" />
                  <c:simple-property
                     name="nameTemplate"
                     default="{contextRoot}"
                     description="Resource name template" />
                  <c:simple-property
                     name="descriptionTemplate"
                     default="Tomcat Web Application"
                     description="Resource description template"
                     readOnly="true" />
               </c:group>
            </plugin-configuration>

            <operation
               name="start"
               description="starts this web application." />

            <operation
               name="stop"
               description="stops this web application." />

            <operation
               name="reload"
               description="reloads this web application." />

            <!-- The two traits below are collected by the ApplicationComponent class, which WarComponent extends.. -->
            <metric
               property="Application.exploded"
               displayName="Exploded deployment"
               dataType="trait"
               displayType="summary"
               description="Whether deployed as a .war file or an exploded directory" />

            <metric
               property="Servlet.NumRequests"
               displayName="Requests served"
               units="none"
               description="Number of requests served by servlets"
               measurementType="trendsup"
               displayType="summary" />

            <metric
               property="Servlet.NumErrors"
               displayName="Processing Errors"
               units="none"
               description="Number of errors while processing servlets"
               measurementType="trendsup"
               displayType="summary" />

            <metric
               property="Session.activeSessions"
               displayName="Currently Active Sessions"
               units="none"
               description="Number active sessions for the webapp right now" />

            <metric
               property="Session.maxActive"
               displayName="Maximum number of Active Sessions"
               units="none"
               description="Maximum number of active sessions for the webapp" />

            <metric
               property="Session.sessionCounter"
               displayName="Sessions created"
               units="none"
               description="Number of sessions created for the webapp"
               measurementType="trendsup" />

            <metric
               property="Session.expiredSessions"
               displayName="Expired Sessions"
               units="none"
               description="Number of expired sessions for the webapp"
               measurementType="trendsup" />

            <metric
               property="Session.rejectedSessions"
               displayName="Rejected Sessions"
               units="none"
               description="Number of sessions rejected for the webapp"
               measurementType="trendsup" />

            <metric
               property="Session.sessionAverageAliveTime"
               displayName="Session Average alive time"
               units="seconds"
               description="Average alive time of a Session" />

            <metric
               property="Session.sessionMaxAliveTime"
               displayName="Max Session alive time"
               units="seconds"
               description="Maximum alive time of a Session" />

            <metric
               property="VHost.name"
               displayName="Virtual Hosts"
               dataType="trait"
               description="Virtual hosts this app runs on" />

            <metric
               property="ResponseTime"
               displayName="HTTP Response Time"
               dataType="calltime"
               defaultOn="false"
               units="milliseconds"
               destinationType="URL"
               description="the minimum, maximum, and average response times for HTTP requests serviced by this web application" />

            <content
               name="file"
               displayName="WAR File"
               category="deployable"
               isCreationType="true">

               <configuration>
                  <c:group
                     name="deployment"
                     displayName="Deployment Options">
                     <c:simple-property
                        name="explodeOnDeploy"
                        displayName="Explode on Deploy"
                        type="boolean"
                        default="true"
                        required="true"
                        description="If yes, then explode the WAR file into the Tomcat deploy directory. If no, leave as a .war file (for no, unpackWARs=false is required on this virtual host)." />
                  </c:group>
               </configuration>
            </content>

            <resource-configuration>
               <c:group name="Attributes">
                  <c:simple-property
                     name="allowLinking"
                     type="boolean"
                     description="If the value of this flag is true, symlinks will be allowed inside the web application, pointing to resources outside the web application base path. If not specified, the default value of the flag is false. NOTE: This flag MUST NOT be set to true on the Windows platform (or any other OS which does not have a case sensitive filesystem), as it will disable case sensitivity checks, allowing JSP source code disclosure, among other security problems." />
                  <c:simple-property
                     name="antiJarLocking"
                     type="boolean"
                     description="If true, the Tomcat classloader will take extra measures to avoid JAR file locking when resources are accessed inside JARs through URLs. This will impact startup time of applications, but could prove to be useful on platforms or configurations where file locking can occur. If not specified, the default value is false." />
                  <c:simple-property
                     name="antiResourceLocking"
                     type="boolean"
                     description="If true, Tomcat will prevent any file locking. This will significantly impact startup time of applications, but allows full webapp hot deploy and undeploy on platforms or configurations where file locking can occur. If not specified, the default value is false. Please note that setting this to true has some side effects, including the disabling of JSP reloading in a running server: see Bugzilla 37668. Please note that setting this flag to true in applications that are outside the appBase for the Host (the webapps directory by default) will cause the application to be deleted on Tomcat shutdown. You probably don't want to do this, so think twice before setting antiResourceLocking=true on a webapp that's outside the appBase for its Host. " />
                  <c:simple-property
                     name="cachingAllowed"
                     type="boolean"
                     description="If the value of this flag is true, the cache for static resources will be used. If not specified, the default value of the flag is true." />
                  <c:simple-property
                     name="cacheTTL"
                     displayName="Cache TTL"
                     type="integer"
                     description="Amount of time in milliseconds between cache entries revalidation. If not specified, the default value is 5000 (5 seconds)." />
                  <c:simple-property
                     name="cacheMaxSize"
                     type="integer"
                     description="Maximum size of the static resource cache in kilobytes. If not specified, the default value is 10240  (10 megabytes)." />
                  <c:simple-property
                     name="cookies"
                     type="boolean"
                     description="Set to true if you want cookies to be used for session identifier communication if supported by the client (this is the default). Set to false if you want to disable the use of cookies for session identifier communication, and rely only on URL rewriting by the application." />
                  <c:simple-property
                     name="compilerClasspath"
                     type="string"
                     description="The compiler classpath to use"
                     required="false" />
                  <c:simple-property
                     name="configFile"
                     type="string"
                     description="The location of the context.xml resource or file Note: Does not exist in Tomcat 7 (return type changed to URL)" 
                     required="false" />
                  <c:simple-property
                     name="crossContext"
                     type="boolean"
                     description="Set to true if you want calls within this application to ServletContext.getContext() to successfully return a request dispatcher for other web applications running on this virtual host. Set to false (the default) in security conscious environments, to make getContext() always return null." />
                  <c:simple-property
                     name="docBase"
                     readOnly="true"
                     required="true"
                     description="The docBase set for this application" />
                   <c:simple-property
                     name="privileged"
                     type="boolean"
                     description="Set to true to allow this context to use container servlets, like the manager servlet. Use of the privileged  attribute will change the context's parent class loader to be the Server class loader rather than the Shared class loader. Note that in a default installation, the Common class loader is used for both the Server and the Shared  class loaders." />
                  <c:simple-property
                     name="reloadable"
                     type="boolean"
                     description="Set to true if you want Catalina to monitor classes in /WEB-INF/classes/ and /WEB-INF/lib for changes, and automatically reload the web application if a change is detected. This feature is very useful during application development, but it requires significant runtime overhead and is not recommended for use on deployed production applications. That's why the default setting for this attribute is false." />
                  <c:simple-property
                     name="saveConfig"
                     type="boolean"
                     description="Write the configuration as needed on startup?" />
                  <c:simple-property
                     name="swallowOutput"
                     type="boolean"
                     description="If the value of this flag is true, the bytes output to System.out and System.err by the web application will be redirected to the web application logger. If not specified, the default value of the flag is false." />
                  <c:simple-property
                     name="unloadDelay"
                     type="integer"
                     description="Amount of ms that the container will wait for servlets to unload. If not specified, the default value of the flag is 2000 ms." />
                  <c:simple-property
                     name="useNaming"
                     type="boolean"
                     description="Set to true (the default) to have Catalina enable a JNDI InitialContext for this web application that is compatible with Java2 Enterprise Edition (J2EE) platform conventions." />
                  <c:simple-property
                     name="workDir"
                     displayName="Work Directory"
                     type="string"
                     description="Pathname to a scratch directory to be provided by this Context for temporary read-write use by servlets within the associated web application. This directory will be made visible to servlets in the web application by a servlet context attribute (of type java.io.File) named javax.servlet.context.tempdir as described in the Servlet Specification. If not specified, a suitable directory underneath $CATALINA_BASE/work will be provided."
                     required="false" />
               </c:group>
            </resource-configuration>            

            <service
               name="Tomcat Datasource"
               discovery="TomcatDatasourceDiscoveryComponent"
               class="TomcatDatasourceComponent"
               description="A Tomcat Application (WAR) Datasource"
               singleton="false">

               <plugin-configuration>
                  <c:group name="General">
                     <c:simple-property
                        name="objectName"
                        readOnly="true"
                        default="Catalina:type=DataSource,path=%path%,host=%host%,class=javax.sql.DataSource,name=%name%" />
                  </c:group>

                  <c:group
                     name="Advanced"
                     hiddenByDefault="true">
                     <c:simple-property
                        name="name"
                        type="string"
                        readOnly="true"
                        description="The virtual host" />
                     <c:simple-property
                        name="host"
                        description="The datasource host"
                        readOnly="true" />
                     <c:simple-property
                        name="path"
                        description="The datasource application path"
                        readOnly="true" />
                     <c:simple-property
                        name="nameTemplate"
                        default="{name}" />
                     <c:simple-property
                        name="descriptionTemplate"
                        default="Tomcat Web Application Datasource"
                        readOnly="true" />
                  </c:group>
               </plugin-configuration>

               <metric
                  property="numActive"
                  displayType="summary"
                  description="Number of active connections in the pool" />
               <metric
                  property="numIdle"
                  displayType="summary"
                  description="Number of idle connections in the pool" /> 
                  
               <resource-configuration>
                  <c:group name="Attributes">
                     <c:simple-property
                        name="initialSize"
                        type="integer"
                        description="The initial number of connections that are created when the pool is started. Default is 0." />
                     <c:simple-property
                        name="maxActive"
                        type="integer"
                        description="The maximum number of active connections that can be allocated from this pool at the same time, or negative for no limit. Default is 8." />
                     <c:simple-property
                        name="maxIdle"
                        type="integer"
                        description="The maximum number of connections that can remain idle in the pool, without extra ones being released, or negative for no limit. Default is 8." />
                     <c:simple-property
                        name="minIdle"
                        type="integer"
                        description="The minimum number of connections that can remain idle in the pool, without extra ones being created, or zero to create none. Default is 0." />                                                                        
                     <c:simple-property
                        name="maxWait"
                        type="integer"
                        description="The maximum number of milliseconds that the pool will wait (when there are no available connections) for a connection to be returned before throwing an exception, or -1 to wait indefinitely. Default is indefinitely." />
                     <c:simple-property
                        name="poolPreparedStatements"
                        type="boolean"
                        description="Enable prepared statement pooling for this pool. Default is false." />                                                                        
                     <c:simple-property
                        name="maxOpenPreparedStatements"
                        type="integer"
                        description="The maximum number of open statements that can be allocated from the statement pool at the same time, or zero for no limit. Default is unlimited." />                                                                        
                     <c:simple-property
                        name="removeAbandoned"
                        type="boolean"
                        description="Flag to remove abandoned connections if they exceed the removeAbandonedTimout. If set to true a connection is considered abandoned and eligible for removal if it has been idle longer than the removeAbandonedTimeout. Setting this to true can recover db connections from poorly written applications which fail to close a connection. Default is false." />                                                                        
                     <c:simple-property
                        name="removeAbandonedTimeout"
                        type="integer"
                        description="Timeout in seconds before an abandoned connection can be removed. Default is 300." />                                                                        
                     <c:simple-property
                        name="logAbandoned"
                        type="boolean"
                        description="Flag to log stack traces for application code which abandoned a Statement or Connection. Logging of abandoned Statements and Connections adds overhead for every Connection open or new Statement because a stack trace has to be generated. Default is false." />                                                                        
                  </c:group>
               </resource-configuration>                                   
            </service>                      

            <service
               name="Tomcat Cache"
               discovery="TomcatCacheDiscoveryComponent"
               class="TomcatCacheComponent"
               description="A Tomcat Application (WAR) Cache"
               singleton="true">

               <plugin-configuration>
                  <c:group name="General">
                     <c:simple-property
                        name="objectName"
                        readOnly="true"
                        default="Catalina:type=Cache,host=%host%,path=%path%" />
                  </c:group>

                  <c:group
                     name="Advanced"
                     hiddenByDefault="true">
                     <c:simple-property
                        name="host"
                        description="The cache host"
                        readOnly="true" />
                     <c:simple-property
                        name="path"
                        description="The cache application path"
                        readOnly="true" />
                     <c:simple-property
                        name="nameTemplate"
                        default="Cache" />
                     <c:simple-property
                        name="descriptionTemplate"
                        default="Tomcat Web Application Cache"
                        readOnly="true" />
                  </c:group>
               </plugin-configuration>

               <metric
                  property="accessCount"
                  displayType="summary"
                  description="Number of cache accesses" />
               <metric
                  property="hitsCount"
                  displayType="summary"
                  description="Number of cache hits" />
               <metric
                  property="cacheSize"
                  displayType="summary"
                  description="Number of cache entries" />
               <metric
                  property="cacheMaxSize"
                  description="Maximum number of cache entries" />
            </service>
            
         </service>

      </service>

      <service
         name="Tomcat Connector"
         discovery="TomcatConnectorDiscoveryComponent"
         class="TomcatConnectorComponent">

         <plugin-configuration>
            <c:group
               name="general"
               displayName="General">
               <c:simple-property
                  name="objectName"
                  readOnly="true"
                  default="Catalina:type=Connector,port=%port%" />
               <c:simple-property
                  name="name"
                  type="string"
                  readOnly="true" 
                  default="Default Tomcat Connector name" 
                  description="Connector name."/>
               <c:simple-property
                  name="port"
                  type="string"
                  description="Port on which this connector is configured to listen."
                  readOnly="true" />
               <c:simple-property
                  name="handler"
                  type="string"
                  description="Connector protocol handler."
                  readOnly="true" />    
               <c:simple-property
                  name="connector"
                  type="string"
                  description="Connector protocol connector."
		  default="Default connector"
                  readOnly="true" />
               <c:simple-property
                  name="address"
                  type="string"
                  description="For servers with more than one IP address, this attribute specifies which address will be used for listening on the specified port. By default, this port will be used on all IP addresses associated with the server." 
                  required="false"
                  readOnly="true" />
               <c:simple-property
                  name="sharedExecutorName"
                  type="string"
                  description="If this Connector is configured to use a shared Executor for its thread pool, this is the name of that Executor. This is required to successfully collect threadpool metrics for the Connector. Leave this unset if the Connector is not using a shared Executor for its threadpool."
                  required="false"
                  readOnly="true" />
            </c:group>

            <c:group
               name="advanced"
               displayName="Advanced"
               hiddenByDefault="true">
               <c:simple-property
                  name="nameTemplate"
                  default="{name}" />
               <c:simple-property
                  name="descriptionTemplate"
                  default="A Tomcat connector" />
            </c:group>
         </plugin-configuration>

         <operation
            name="start"
            displayName="Start"
            description="Starts this connector" />

         <operation
            name="stop"
            displayName="Stop"
            description="Stops this connector" />

         <operation
            name="pause"
            displayName="Pause"
            description="Pauses this connector" />

         <operation
            name="resume"
            displayName="Resume"
            description="Resumes this connector" />

         <metric
            property="Catalina:type=GlobalRequestProcessor,name=%name%:maxTime"
            displayName="Maximum Request Time"
            description="Maximum time it took to process a request."
            units="milliseconds"
            category="performance" />

         <metric
            property="Catalina:type=GlobalRequestProcessor,name=%name%:requestCount"
            displayName="Request count"
            description="Total number of requests processed since last restart."
            category="utilization"
            measurementType="trendsup" />

         <metric
            property="Catalina:type=GlobalRequestProcessor,name=%name%:errorCount"
            displayName="Error count"
            description="Number of errors while processing since last restart."
            category="utilization"
            measurementType="trendsup" />

         <metric
            property="Catalina:type=ThreadPool,name=%name%:currentThreadsBusy"
            displayName="Threadpool Threads Active"
            description="Number of current busy threads."
            category="utilization"
            displayType="summary" />

         <metric
            property="Catalina:type=ThreadPool,name=%name%:currentThreadCount"
            displayName="Threadpool Threads Allocated"
            description="Number of current threads."
            category="utilization"
            displayType="summary" />

         <metric
            property="Catalina:type=ThreadPool,name=%name%:maxThreads"
            displayName="Threadpool Max Threads"
            description="Maximum number of threads that can be allocated for the ThreadPool."
            category="utilization"
            displayType="detail" />

         <resource-configuration>
            <c:group name="Common">
               <c:simple-property
                  name="allowTrace"
                  type="boolean"
                  description="A boolean value which can be used to enable or disable the TRACE HTTP method. If not specified, this attribute is set to false."
                  required="false"
                  default="false" />
               <c:simple-property
                  name="connectionTimeout"
                  type="integer"
                  description="HTTP: The number of milliseconds this Connector will wait, after accepting a connection, for the request URI line to be presented. The default value is 60000 (i.e. 60 seconds). AJP: The number of milliseconds this Connector will wait, after accepting a connection, for the request URI line to be presented. The default value is infinite (i.e. no timeout)."
                  required="false"
                  default="-1" />
               <c:simple-property
                  name="emptySessionPath"
                  type="boolean"
                  description="If set to true, all paths for session cookies will be set to /. This can be useful for portlet specification implementations, but will greatly affect performance if many applications are accessed on a given server by the client. If not specified, this attribute is set to false. Note: Does not exist in Tomcat 7" 
                  required="false"
                  default="false" />
               <c:simple-property
                  name="enableLookups"
                  type="boolean"
                  description="Set to true if you want calls to request.getRemoteHost() to perform DNS lookups in order to return the actual host name of the remote client. Set to false to skip the DNS lookup and return the IP address in String form instead (thereby improving performance). By default, DNS lookups are enabled."
                  required="false"
                  default="false" />
               <c:simple-property
                  name="keepAliveTimeout"
                  type="integer"
                  description="Ignored prior to Tomcat 6. HTTP: The number of milliseconds this Connector will wait for another HTTP request before closing the connection. The default value is to use the value that has been set for the connectionTimeout attribute. AJP: The number of milliseconds this Connector will wait for another AJP request before closing the connection. The default value is to use the value that has been set for the connectionTimeout attribute."
                  required="false"
                  default="-1" />
               <c:simple-property
                  name="maxPostSize"
                  type="integer"
                  description="The maximum size in bytes of the POST which will be handled by the container FORM URL parameter parsing. The limit can be disabled by setting this attribute to a value less than or equal to 0. If not specified, this attribute is set to 2097152 (2 megabytes)."
                  required="false"
                  default="2097152" />
               <c:simple-property
                  name="maxThreads"
                  type="integer"
                  description="HTTP: The maximum number of request processing threads to be created by this Connector, which therefore determines the maximum number of simultaneous requests that can be handled. If not specified, this attribute is set to 40. If an executor is associated with this connector, this attribute is ignored as the connector will execute tasks using the executor rather than an internal thread pool. AJP: The maximum number of request processing threads to be created by this Connector, which therefore determines the maximum number of simultaneous requests that can be handled. If not specified, this attribute is set to 200. If an executor is associated with this connector, this attribute is ignored as the connector will execute tasks using the executor rather than an internal thread pool."
                  required="false"
                  default="200" />                  
               <c:simple-property
                  name="protocol"
                  type="string"
                  description="The protocol to handle incoming traffic." />
               <c:simple-property
                  name="proxyName"
                  type="string"
                  description="If this Connector is being used in a proxy configuration, configure this attribute to specify the server name to be returned for calls to request.getServerName()."
                  required="false" />
               <c:simple-property
                  name="proxyPort"
                  type="integer"
                  description="If this Connector is being used in a proxy configuration, configure this attribute to specify the server port to be returned for calls to request.getServerPort()."
                  required="false"
                  default="0" />
               <c:simple-property
                  name="redirectPort"
                  type="integer"
                  description="If this Connector is supporting non-SSL requests, and a request is received for which a matching security-constraint requires SSL transport, Catalina will automatically redirect the request to the port number specified here."
                  required="false"
                  default="0" />
               <c:simple-property
                  name="scheme"
                  type="string"
                  description="The name of the protocol you wish to have returned by calls to request.getScheme(). For example, you would set this attribute to 'https' for an SSL Connector. The default value is 'http'"
                  default="http" />                  
               <c:simple-property
                  name="secure"
                  type="boolean"
                  description="Set this attribute to true if you wish to have calls to request.isSecure() to return true  for requests received by this Connector. You would want this on an SSL Connector or a non SSL connector that is receiving data from a SSL accelerator, like a crypto card, a SSL appliance or even a webserver. The default value is false"
                  required="false"
                  default="false" />
               <c:simple-property
                  name="tcpNoDelay"
                  displayName="TCP NoDelay"
                  type="boolean"
                  description="If set to true, the TCP_NO_DELAY option will be set on the server socket, which improves performance under most circumstances. This is set to true by default."
                  default="true"
                  required="false" />                  
               <c:simple-property
                  name="URIEncoding"
                  displayName="URI Encoding"
                  type="string"
                  description="This specifies the character encoding used to decode the URI bytes, after %xx decoding the URL. If not specified, ISO-8859-1 will be used. "                  
                  required="false"
                  default="ISO-8859-1" />                  
               <c:simple-property
                  name="useBodyEncodingForURI"
                  displayName="Use Body Encoding for URI"
                  type="boolean"
                  description="This specifies if the encoding specified in contentType should be used for URI query parameters, instead of using the URIEncoding. This setting is present for compatibility with Tomcat 4.1.x."
                  default="false" />
               <c:simple-property
                  name="xpoweredBy"
                  displayName="X-Powered-By"
                  type="boolean"
                  description="Set this attribute to true to cause Tomcat to advertise support for the Servlet specification using the header recommended in the specification. The default value is false."
                  required="false"
                  default="false" />
               <c:simple-property
                  name="acceptCount"
                  type="integer"
                  description="The maximum queue length for incoming connection requests when all possible request processing threads are in use. Any requests received when the queue is full will be refused. The default value is 10."
                  required="false"
                  default="100" />
               <c:simple-property
                  name="address"
                  type="string"
                  description="For servers with more than one IP address, this attribute specifies which address will be used for listening on the specified port. By default, this port will be used on all IP addresses associated with the server." 
                  required="false" />
               <c:simple-property
                  name="connectionLinger"
                  type="integer"
                  description="The number of milliseconds during which the sockets used by this Connector will linger when they are closed. (-1 socket linger is disabled)."
                  required="false"
                  default="-1" />
               <c:simple-property
                  name="disableUploadTimeout"
                  type="boolean"
                  description="This flag allows the servlet container to use a different, longer connection timeout while a servlet is being executed, which in the end allows either the servlet a longer amount of time to complete its execution, or a longer timeout during data upload. If not specified, this attribute is set to true."
                  required="false"
                  default="true" />                  
               <c:simple-property
                  name="maxHttpHeaderSize"
                  type="integer"
                  description="The maximum size of the request and response HTTP header, specified in bytes. If not specified, this attribute is set to 4096 (4 KB)."
                  required="false"
                  default="8192" />
               <c:simple-property
                  name="maxKeepAliveRequests"
                  type="integer"
                  description="The maximum number of HTTP requests which can be pipelined until the connection is closed by the server. Setting this attribute to 1 will disable HTTP/1.0 keep-alive, as well as HTTP/1.1 keep-alive and pipelining. Setting this to -1 will allow an unlimited amount of pipelined or keep-alive HTTP requests. If not specified, this attribute is set to 100."
                  required="false"
                  default="100" />
               <c:simple-property
                  name="maxSpareThreads"
                  type="integer"
                  description="The maximum number of unused request processing threads that will be allowed to exist until the thread pool starts stopping the unnecessary threads. The default value is 50."
                  required="false"
                  default="50" />
               <c:simple-property
                  name="minSpareThreads"
                  type="integer"
                  description="The number of request processing threads that will be created when this Connector is first started. The connector will also make sure it has the specified number of idle processing threads available. This attribute should be set to a value smaller than that set for maxThreads. The default value is 4."
                  required="false"
                  default="4" />                  
               <c:simple-property
                  name="strategy"
                  type="string"
                  description="The thread pooling strategy which will be used. The default strategy does not use a master thread, but a more conventional strategy using a master listener thread can be used by setting 'ms' as this attribute's value. The master strategy will work significantly better using the threadPriority attribute, which will apply only to the thread which listens on the server socket. This is set to 'lf' by default."
                  required="false"
                  default="lf" />                  
               <c:simple-property
                  name="threadPriority"
                  type="integer"
                  description="The priority of the request processing threads within the JVM. The default value is java.lang.Thread#NORM_PRIORITY. See the JavaDoc for the java.lang.Thread class for more details on what this priority means."
                  required="false"
                  default="5" />
            </c:group>

            <c:group name="HTTP" hiddenByDefault="true">
               <c:simple-property
                  name="compression"
                  type="string"
                  description="The Connector may use HTTP/1.1 GZIP compression in an attempt to save server bandwidth. The acceptable values for the parameter is 'off' (disable compression), 'on' (allow compression, which causes text data to be compressed), 'force' (forces compression in all cases), or a numerical integer value (which is equivalent to 'on', but specifies the minimum amount of data before the output is compressed). If the content-length is not known and compression is set to 'on' or more aggressive, the output will also be compressed. If not specified, this attribute is set to 'off'."
                  required="false"
                  default="true" />                  
            </c:group>

            <c:group name="HTTP SSL" hiddenByDefault="true">
               <c:simple-property
                  name="algorithm"
                  type="string"
                  description="The certificate encoding algorithm to be used. This defaults to the Sun implementation (SunX509). For IBM JVMs you should use the value IbmX509. For other vendors, consult the JVM documentation for the correct value."
                  required="false" />
               <c:simple-property
                  name="ciphers"
                  type="string"
                  description="The comma separated list of encryption ciphers that this socket is allowed to use. By default, the default ciphers for the JVM will be used. Note that this usually means that the weak export grade ciphers will be included in the list of available ciphers. The ciphers are specified using the JSSE cipher naming convention."
                  required="false" />
               <c:simple-property
                  name="clientAuth"
                  displayName="Client Authentication"
                  type="boolean"
                  description="Set to true if you want the SSL stack to require a valid certificate chain from the client before accepting a connection. Set to want if you want the SSL stack to request a client Certificate, but not fail if one isn't presented. A false  value (which is the default) will not require a certificate chain unless the client requests a resource protected by a security constraint that uses CLIENT-CERT authentication."
                  required="false" />
               <c:simple-property
                  name="keyAlias"
                  type="string"
                  description="The alias used to for the server certificate in the keystore. If not specified the first key read in the keystore will be used."
                  required="false" />
               <c:simple-property
                  name="keystorePass"
                  displayName="Keystore Password"
                  type="password"
                  description="The password used to access the server certificate from the specified keystore file."
                  required="false" />
               <c:simple-property
                  name="keystoreFile"
                  type="string"
                  description="Path to the keystore file used to validate client certificates."
                  required="false" />
               <c:simple-property
                  name="keystoreType"
                  type="string"
                  description="The type of keystore file to be used for the server certificate. If not specified, the default value is 'JKS'."
                  required="false" />
               <c:simple-property
                  name="sslProtocol"
                  displayName="SSL Protocol"
                  type="string"
                  description="The version of the SSL protocol to use. If not specified, the default is 'TLS'."
                  required="false" />
               <c:simple-property
                  name="trustStoreFile"
                  type="string"
                  description="Path to the trust store file used to validate client certificates."
                  required="false" />
               <c:simple-property
                  name="trustStorePass"
                  displayName="Trust Store Password"
                  type="password"
                  description="The password to access the TrustStore. This defaults to the value of Keystore Password."
                  required="false" />
               <c:simple-property
                  name="trustStoreType"
                  type="string"
                  description="Add this element if your are using a different format for the TrustStore then you are using for the KeyStore."
                  required="false" />            
            </c:group>

            <c:group name="AJP" hiddenByDefault="true">
               <c:simple-property
                  name="tomcatAuthentication"
                  type="boolean"
                  description="If set to true, the authentication will be done in Tomcat. Otherwise, the authenticated principal will be propagated from the native web server and used for authorization in Tomcat. The default value is true."
                  required="false" />
            </c:group>
         </resource-configuration>

      </service>

      <service
         name="Tomcat User Database"
         discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
         class="TomcatUserDatabaseComponent"
         description="Tomcat User Database"
         singleton="true">

         <plugin-configuration>
            <c:group name="General">
               <c:simple-property
                  name="objectName"
                  readOnly="true"
                  default="Users:type=UserDatabase,database=UserDatabase" />
            </c:group>

            <c:group
               name="Advanced"
               hiddenByDefault="true">
               <c:simple-property
                  name="nameTemplate"
                  default="User Database" />
               <c:simple-property
                  name="descriptionTemplate"
                  default="User Database"
                  readOnly="true" />
            </c:group>
         </plugin-configuration>

         <operation
            name="save"
            description="Save current users and groups to persistent storage.">
         </operation>

         <service
            name="Tomcat Group"
            discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
            class="TomcatGroupComponent"
            description="Tomcat User Group"
            createDeletePolicy="both"
            creationDataType="configuration">

            <plugin-configuration>
               <c:group name="General">
                  <c:simple-property
                     name="objectName"
                     readOnly="true"
                     default="Users:type=Group,groupname=%name%,database=UserDatabase" />
               </c:group>

               <c:group
                  name="Advanced"
                  hiddenByDefault="true">
                  <c:simple-property
                     name="name"
                     displayName="groupname"
                     readOnly="true"
                     description="ObjectName groupname value." />
                  <c:simple-property
                     name="nameTemplate"
                     default="{name}" />
                  <c:simple-property
                     name="descriptionTemplate"
                     default="A Tomcat Group"
                     readOnly="true" />
               </c:group>
            </plugin-configuration>

            <resource-configuration>
               <c:group name="Attributes">
                  <c:simple-property
                     name="groupname"
                     displayName="Group Name"
                     required="true"
                     readOnly="true"
                     description="The Group name." />
                  <c:simple-property
                     name="description"
                     required="false"
                     description="The Group description." />
                  <c:simple-property
                     name="roles"
                     type="longString"
                     required="false"
                     description="Roles assigned to the Group. When editing, roles are case sensitive, must exist, and be on a new line." />
               </c:group>
            </resource-configuration>
         </service>

         <service
            name="Tomcat Role"
            discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
            class="TomcatRoleComponent"
            description="Tomcat User Role"
            createDeletePolicy="both"
            creationDataType="configuration">

            <plugin-configuration>
               <c:group name="General">
                  <c:simple-property
                     name="objectName"
                     readOnly="true"
                     default="Users:type=Role,rolename=%name%,database=UserDatabase" />
               </c:group>

               <c:group
                  name="Advanced"
                  hiddenByDefault="true">
                  <c:simple-property
                     name="name"
                     displayName="rolename"
                     readOnly="true"
                     description="ObjectName rolename value." />
                  <c:simple-property
                     name="nameTemplate"
                     default="{name}" />
                  <c:simple-property
                     name="descriptionTemplate"
                     default="A Tomcat Role"
                     readOnly="true" />
               </c:group>
            </plugin-configuration>

            <resource-configuration>
               <c:group name="Attributes">
                  <c:simple-property
                     name="rolename"
                     displayName="Role Name"
                     required="true"
                     readOnly="true"
                     description="The Role name." />
                  <c:simple-property
                     name="description"
                     required="false"
                     description="The Role description." />
               </c:group>
            </resource-configuration>
         </service>

         <service
            name="Tomcat User"
            discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
            class="TomcatUserComponent"
            description="Tomcat User"
            createDeletePolicy="both"
            creationDataType="configuration">

            <plugin-configuration>
               <c:group name="General">
                  <c:simple-property
                     name="objectName"
                     readOnly="true"
                     default="Users:type=User,username=%name%,database=UserDatabase" />
               </c:group>

               <c:group
                  name="Advanced"
                  hiddenByDefault="true">
                  <c:simple-property
                     name="name"
                     displayName="username"
                     readOnly="true"
                     required="true"
                     description="ObjectName username value." />
                  <c:simple-property
                     name="nameTemplate"
                     default="{name}" />
                  <c:simple-property
                     name="descriptionTemplate"
                     default="A Tomcat User"
                     readOnly="true" />
               </c:group>
            </plugin-configuration>

            <resource-configuration>
               <c:group name="Attributes">
                  <c:simple-property
                     name="username"
                     required="true"
                     readOnly="true"
                     description="The username" />
                  <c:simple-property
                     name="password"
                     type="password"
                     required="false"
                     description="The credentials used to authenticate the username." />
                  <c:simple-property
                     name="fullName"
                     required="false"
                     description="The full name of the User" />
                  <c:simple-property
                     name="groups"
                     type="longString"
                     required="false"
                     description="Groups assigned to the User. When editing, groups are case sensitive, must exist, and be on a new line." />
                  <c:simple-property
                     name="roles"
                     type="longString"
                     required="false"
                     description="Roles assigned to the User. When editing, roles are case sensitive, must exist, and be on a new line." />
               </c:group>
            </resource-configuration>
         </service>

      </service>

   </server>

</plugin>
